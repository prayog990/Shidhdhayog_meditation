<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>शिद्धयोग ध्यान - Shidhdhayog Dhyan</title>
    <style>
        /* --- THEME ENGINE --- */
        :root, body[data-theme="default-dark"] {
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --app-title-color: #ffffff;
            --btn-text-color: #ffffff;
            --primary-btn-bg: linear-gradient(45deg, #ff6b6b, #ee5a24);
            --secondary-btn-bg: linear-gradient(45deg, #74b9ff, #0984e3);
            --tertiary-btn-bg: linear-gradient(45deg, #a29bfe, #6c5ce7);
            --modal-bg: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            --modal-text-color: #343a40;
            --modal-header-color: #667eea;
            --meditation-screen-bg: #000000;
            --control-btn-bg: rgba(255, 255, 255, 0.15);
            --control-btn-border: rgba(255, 255, 255, 0.3);
            --timer-bg: rgba(0, 0, 0, 0.5);
            --timer-text: #ffffff;
            --bottom-popup-bg: rgba(40, 40, 40, 0.85);
        }
        body[data-theme="night-sky"] {
            --bg-gradient: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            --primary-btn-bg: linear-gradient(45deg, #DA4453, #89216B);
            --secondary-btn-bg: linear-gradient(45deg, #1D4350, #A43931);
            --tertiary-btn-bg: linear-gradient(45deg, #4776E6, #8E54E9);
            --modal-bg: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            --modal-text-color: #ecf0f1;
            --modal-header-color: #1abc9c;
        }
        body[data-theme="deep-forest"] {
            --bg-gradient: linear-gradient(135deg, #134E5E 0%, #71B280 100%);
            --primary-btn-bg: linear-gradient(45deg, #ff8008, #ffc837);
            --secondary-btn-bg: linear-gradient(45deg, #009688, #4CAF50);
            --tertiary-btn-bg: linear-gradient(45deg, #603813, #b29f94);
            --modal-bg: linear-gradient(135deg, #364d41 0%, #4a6857 100%);
            --modal-text-color: #f2f2f2;
            --modal-header-color: #ffc837;
        }
        body[data-theme="sunrise"] {
            --bg-gradient: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 99%, #fad0c4 100%);
            --app-title-color: #4a47a3;
            --btn-text-color: #ffffff;
            --primary-btn-bg: linear-gradient(45deg, #ff758c, #ff7eb3);
            --secondary-btn-bg: linear-gradient(45deg, #f093fb, #f5576c);
            --tertiary-btn-bg: linear-gradient(45deg, #a18cd1, #fbc2eb);
            --modal-bg: linear-gradient(135deg, #ffffff 0%, #fefefe 100%);
            --modal-text-color: #555;
            --modal-header-color: #ff758c;
        }
        body[data-theme="mint"] {
            --bg-gradient: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%);
            --app-title-color: #07455d;
            --primary-btn-bg: linear-gradient(45deg, #56ab2f, #a8e063);
            --secondary-btn-bg: linear-gradient(45deg, #00B4DB, #0083B0);
            --tertiary-btn-bg: linear-gradient(45deg, #6190E8, #A7BFE8);
            --modal-bg: linear-gradient(135deg, #ffffff 0%, #f8fdff 100%);
            --modal-text-color: #333;
            --modal-header-color: #0083B0;
        }
        body[data-theme="peaceful-lilac"] {
            --bg-gradient: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%);
            --app-title-color: #2c3a61;
            --primary-btn-bg: linear-gradient(45deg, #89f7fe, #66a6ff);
            --secondary-btn-bg: linear-gradient(45deg, #ffdde1, #ee9ca7);
            --tertiary-btn-bg: linear-gradient(45deg, #d4a5a5, #ffa3a3);
            --modal-bg: linear-gradient(135deg, #ffffff 0%, #fdfcff 100%);
            --modal-text-color: #444;
            --modal-header-color: #89f7fe;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-gradient);
            background-attachment: fixed;
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
            transition: background 0.5s ease-in-out;
        }
        .container { max-width: 400px; margin: 0 auto; padding: 20px; text-align: center; }
        .app-title { color: var(--app-title-color); font-size: 28px; margin-bottom: 30px; text-shadow: 3px 3px 8px rgba(0,0,0,0.4); font-weight: 600; letter-spacing: 1px; cursor: pointer; user-select: none; }
        .guru-photo-container { position: relative; width: 200px; height: 200px; margin: 0 auto 30px; border-radius: 50%; overflow: hidden; box-shadow: 0 15px 40px rgba(0,0,0,0.4), 0 0 0 4px rgba(255,255,255,0.1); cursor: default; transition: all 0.4s ease; background: #000; }
        .guru-photo-container:hover { transform: scale(1.05); box-shadow: 0 20px 50px rgba(0,0,0,0.5), 0 0 0 4px rgba(255,255,255,0.2); }
        .guru-photo { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 18px; color: #666; }
        .main-buttons { display: flex; gap: 15px; justify-content: center; margin-bottom: 30px; }
        .btn { padding: 16px 28px; border: none; border-radius: 30px; font-size: 16px; font-weight: bold; cursor: pointer; transition: all 0.4s ease; box-shadow: 0 6px 20px rgba(0,0,0,0.25); position: relative; overflow: hidden; color: var(--btn-text-color); }
        .btn::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent); transition: left 0.5s ease; }
        .btn:hover::before { left: 100%; }
        .btn-start { background: var(--primary-btn-bg); }
        .btn-info { background: var(--secondary-btn-bg); }
        .btn-settings { background: var(--tertiary-btn-bg); width: 100%; margin-bottom: 20px; }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(0,0,0,0.3); }
        #adminButton { display: none; }
        .meditation-screen { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: var(--meditation-screen-bg); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; cursor: default; }
        .meditation-photo { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: #666; font-size: 18px; background: transparent; }
        .meditation-photo img { max-width: 100%; max-height: 100%; object-fit: contain; }
        .timer-display { position: absolute; top: 40px; left: 50%; transform: translateX(-50%); z-index: 10; font-size: 28px; background: var(--timer-bg); color: var(--timer-text); padding: 8px 20px; border-radius: 20px; font-weight: 300; text-shadow: 1px 1px 5px rgba(0,0,0,0.6); font-family: 'Courier New', monospace; letter-spacing: 2px; opacity: 0; pointer-events: none; transition: opacity 0.5s ease; }
        .meditation-controls { position: absolute; bottom: calc(30px + env(safe-area-inset-bottom)); left: 50%; transform: translateX(-50%); z-index: 10; display: flex; gap: 20px; opacity: 0; pointer-events: none; transition: opacity 0.5s ease, bottom 0.3s ease; }
        .meditation-screen.controls-visible .timer-display, .meditation-screen.controls-visible .meditation-controls { opacity: 1; pointer-events: auto; }
        .control-btn { padding: 12px 25px; border-radius: 30px; font-size: 16px; font-weight: 600; min-width: 100px; text-align: center; background: var(--control-btn-bg); border: 1px solid var(--control-btn-border); color: white; cursor: pointer; backdrop-filter: blur(10px); transition: all 0.4s ease; text-shadow: 1px 1px 3px rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; }
        .control-btn:hover { background: rgba(255,255,255,0.25); border-color: rgba(255,255,255,0.6); transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.3); }
        .countdown-screen { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: var(--bg-gradient); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 1001; }
        .countdown-number { font-size: 130px; color: white; font-weight: bold; text-shadow: 4px 4px 15px rgba(0,0,0,0.4); animation: pulse 1s ease-in-out; font-family: 'Segoe UI', sans-serif; }
        @keyframes pulse { 0% { transform: scale(0.7); opacity: 0.4; } 50% { transform: scale(1.3); opacity: 1; text-shadow: 6px 6px 20px rgba(0,0,0,0.6); } 100% { transform: scale(1); opacity: 1; text-shadow: 4px 4px 15px rgba(0,0,0,0.4); } }
        .modal { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: 1002; backdrop-filter: blur(5px); }
        .modal-content { background: var(--modal-bg); color: var(--modal-text-color); padding: 30px; border-radius: 20px; max-width: 350px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.2); transform: scale(0.9); opacity: 0; transition: all 0.3s ease; position: relative; }
        .modal.visible .modal-content { transform: scale(1); opacity: 1; }
        .modal h3 { margin-bottom: 20px; color: var(--modal-header-color); }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500;}
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .mantra-controls { position: fixed; bottom: calc(60px + env(safe-area-inset-bottom)); left: 50%; transform: translateX(-50%); display: none; z-index: 1001; transition: bottom 0.3s ease; }
        .info-content { text-align: left; line-height: 1.6; }
        .info-content h4 { margin: 15px 0 10px 0; color: var(--modal-header-color); }
        .info-content ul { margin-left: 20px; list-style-position: inside; }
        .info-content li { margin-bottom: 5px; }
        #confirmMessage { font-size: 18px; margin-bottom: 25px; line-height: 1.5; text-align: center; }
        .confirm-buttons { display: flex; gap: 15px; }
        .confirm-buttons .btn { flex: 1; }
        .bottom-popup {
            position: absolute;
            bottom: calc(20px + env(safe-area-inset-bottom));
            left: 20px;
            right: 20px;
            width: auto;
            transform: none;
            background: var(--bottom-popup-bg);
            backdrop-filter: blur(10px);
            padding: 20px 30px;
            border-radius: 15px;
            text-align: center;
            z-index: 20;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
        }
        .bottom-popup p { font-size: 20px; color: white; margin-bottom: 20px; }
        .modal-close-btn { position: absolute; top: 15px; right: 15px; background: #e0e0e0; border: none; border-radius: 50%; width: 30px; height: 30px; font-size: 20px; color: #888; cursor: pointer; line-height: 30px; text-align: center; transition: all 0.3s ease; }
        .modal-close-btn:hover { background: #d0d0d0; color: #333; transform: rotate(90deg); }
        .time-stepper { display: flex; align-items: center; justify-content: center; gap: 15px; }
        .time-stepper button { width: 40px; height: 40px; border-radius: 50%; border: 1px solid #ccc; background: #f0f0f0; font-size: 24px; font-weight: bold; color: var(--modal-header-color); cursor: pointer; transition: all 0.2s ease; }
        .time-stepper button:hover { background: #e0e0e0; transform: scale(1.1); }
        .time-stepper span { font-size: 22px; font-weight: 500; min-width: 40px; text-align: center; }
        .color-picker { width: 100%; height: 40px; padding: 0 5px; border-radius: 8px; border: 1px solid #ddd; cursor: pointer; }
.custom-color-picker { display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; margin-top: 5px; }
.color-swatch { width: 38px; height: 38px; border-radius: 50%; cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease; border: 2px solid transparent; }
.color-swatch:hover { transform: scale(1.1); }
.color-swatch.selected { border-color: var(--modal-header-color); box-shadow: 0 0 10px rgba(0,0,0,0.2); transform: scale(1.15); }
        @media (max-width: 480px) {
            .timer-display { font-size: 24px; top: 20px; }
            .countdown-number { font-size: 80px; }
            .control-btn { padding: 10px 18px; font-size: 14px; min-width: 80px; }
            .meditation-controls { bottom: calc(20px + env(safe-area-inset-bottom)); }
        }
    </style>
</head>
<body data-theme="default-dark">
    <div class="container">
        <h1 class="app-title" data-lang-key="appTitle">🕉️ शिद्धयोग ध्यान</h1>
        <div class="guru-photo-container">
            <div class="guru-photo" id="guruPhoto"></div>
        </div>
        <div class="main-buttons">
            <button class="btn btn-start" onclick="startMeditation()" data-lang-key="startButton">🧘‍♂️ शुरू करें</button>
            <button class="btn btn-info" onclick="showInfo()" data-lang-key="infoButton">ℹ️ कैसे करें</button>
        </div>
        <button class="btn btn-settings" onclick="showSettings()" data-lang-key="settingsButton">⚙️ सेटिंग्स</button>
        <button id="adminButton" class="btn btn-settings" onclick="showAdminPanel()" style="background: linear-gradient(45deg, #e17055, #d63031); margin-top: 10px;" data-lang-key="adminButton">👨‍💼 एडमिन पैनल</button>
    </div>

    <!-- Countdown Screen -->
    <div class="countdown-screen" id="countdownScreen">
        <div class="countdown-number" id="countdownNumber">5</div>
        <div style="color: white; margin-top: 30px; font-size: 18px;" data-lang-key="countdownText">ध्यान शुरू होने में...</div>
    </div>

    <!-- Meditation Screen -->
    <div class="meditation-screen" id="meditationScreen">
        <div class="meditation-photo" id="meditationPhoto"></div>
        <div class="timer-display" id="timerDisplay">15:00</div>
        <div class="meditation-controls">
            <button class="control-btn" id="pausePlayBtn" onclick="togglePausePlay()" data-lang-key="pause">रोकें</button>
            <button class="control-btn" onclick="restartMeditation()" data-lang-key="restart">फिर शुरू करें</button>
            <button class="control-btn" onclick="goBack()" data-lang-key="back">वापस</button>
            <button id="skipButton" class="control-btn" onclick="skipMeditationTimer()" style="display:none; background: #c0392b;" data-lang-key="skipTimer">टाइमर स्किप</button>
        </div>
        <div class="bottom-popup" id="endScreenMessage" style="display: none;">
            <p data-lang-key="completionMessage">🙏 ध्यान पूर्ण हुआ 🙏</p>
            <button class="btn btn-start" id="okButton">ठीक है</button>
        </div>
        <div id="finalControls" class="meditation-controls" style="opacity: 0; pointer-events: none;">
            <button class="btn btn-start" onclick="goBack(false)" data-lang-key="finalBackButton">वापस जाएं</button>
        </div>
    </div>

    <!-- Mantra Controls -->
    <div class="mantra-controls" id="mantraControls">
        <button class="control-btn" onclick="skipMantra()" data-lang-key="skipMantra">⏭️ मंत्र स्किप</button>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeSettings()">×</button>
            <h3 data-lang-key="settingsTitle">⚙️ सेटिंग्स</h3>
            <div class="form-group"><label data-lang-key="languageLabel">भाषा</label><select id="languageSelect" onchange="changeLanguage(this.value)"><option value="hindi">हिन्दी</option><option value="english">English</option></select></div>
            <div class="form-group">
                <label data-lang-key="themeLabel">थीम</label>
                <select id="themeSelect" onchange="changeTheme(this.value)"></select>
            </div>
            <div class="form-group">
                <label data-lang-key="timeLabel">ध्यान का समय (मिनट)</label>
                <div class="time-stepper">
                    <button id="timeDecrement">-</button>
                    <span id="timeValue">15</span>
                    <button id="timeIncrement">+</button>
                </div>
            </div>
            <div class="form-group">
            <label data-lang-key="bgColorLabel">ध्यान स्क्रीन का रंग</label>
            <div id="customColorPicker" class="custom-color-picker"></div>
        </div>
            <div style="text-align: center; color: #777; margin-top: 20px;"><p data-lang-key="settingsInfo">मंत्र, अलार्म और गुरुदेव की फोटो पहले से ही सेट हैं।</p></div>
        </div>
    </div>
    
    <!-- Admin/Info/Confirm Modals -->
    <div class="modal" id="adminModal">
         <div class="modal-content" style="max-width: 500px;">
            <button class="modal-close-btn" onclick="closeAdminPanel()">×</button>
            <h3 data-lang-key="adminPanelTitle">👨‍💼 एडमिन पैनल</h3>
            <div class="form-group"><label data-lang-key="mainTitleLabel"><strong>मुख्य शीर्षक</strong></label><input type="text" id="adminMainTitle"></div>
            <div class="form-group"><label data-lang-key="meditationStepsLabel"><strong>ध्यान की विधि (हर लाइन नई)</strong></label><textarea id="adminMeditationSteps" rows="5"></textarea></div>
            <div class="form-group"><label data-lang-key="benefitsLabel"><strong>ध्यान के लाभ (हर लाइन नया)</strong></label><textarea id="adminBenefits" rows="4"></textarea></div>
            <div class="form-group"><label data-lang-key="appUsageLabel"><strong>ऐप का उपयोग (हर लाइन नई)</strong></label><textarea id="adminAppUsage" rows="4"></textarea></div>
            <div class="form-group"><label data-lang-key="extraInfoLabel"><strong>अतिरिक्त जानकारी (वैकल्पिक)</strong></label><textarea id="adminExtraInfo" rows="3"></textarea></div>
            <div style="display: flex; gap: 10px; margin-top: 30px;"><button class="btn btn-start" onclick="saveAdminSettings()" style="flex: 1;" data-lang-key="saveButton">💾 सेव करें</button><button class="btn btn-info" onclick="previewInfo()" style="flex: 1;" data-lang-key="previewButton">👁️ प्रीव्यू</button></div>
         </div>
    </div>
    <div class="modal" id="infoModal">
         <div class="modal-content">
            <button class="modal-close-btn" onclick="closeInfo()">×</button>
            <h3 id="infoTitle" data-lang-key="howToTitle">🧘‍♂️ ध्यान कैसे करें</h3>
            <div class="info-content" id="infoContentDiv"></div>
            <button class="btn btn-info" onclick="closeInfo()" style="width: 100%; margin-top: 20px;" data-lang-key="gotItButton">✅ समझ गया</button>
         </div>
    </div>
    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <p id="confirmMessage">क्या आप निश्चित हैं?</p>
            <div class="confirm-buttons">
                <button id="confirmYes" class="btn btn-start">हाँ</button>
                <button id="confirmNo" class="btn btn-info">नहीं</button>
            </div>
        </div>
    </div>

    <script>
        // --- GLOBAL VARIABLES ---
        let meditationTimer, countdownTimer, mantraAudio, alarmAudio;
        let isMantraPlaying = false, isPaused = false, totalSeconds;

        // --- THEME DEFINITIONS ---
        const themes = {
            'default-dark': { name: 'Default Dark', isDark: true },
            'night-sky': { name: 'Night Sky', isDark: true },
            'deep-forest': { name: 'Deep Forest', isDark: true },
            'sunrise': { name: 'Sunrise', isDark: false },
            'mint': { name: 'Mint', isDark: false },
            'peaceful-lilac': { name: 'Peaceful Lilac', isDark: false },
        };

        // --- STATE MANAGEMENT ---
        const appState = {
            meditationTime: 15,
            language: 'hindi',
            theme: 'default-dark',
            meditationBgColor: '#000000',
            customInfo: {
                hindi: {
                    mainTitle: "शिद्धयोग ध्यान की विधि:",
                    meditationSteps: ["तैयारी: शांत स्थान पर बैठें, आंखें बंद करें", "दीक्षा मंत्र: पहले गुरुदेव का दीक्षा मंत्र सुनें", "गुरु दर्शन: गुरुदेव की फोटो पर ध्यान केंद्रित करें", "श्वास: सामान्य श्वास लें, मन को शांत रखें", "समर्पण: पूर्ण समर्पण भाव रखें"],
                    benefits: ["मानसिक शांति", "आध्यात्मिक उन्नति", "एकाग्रता में वृद्धि", "तनाव मुक्ति"],
                    appUsage: ["गुरुदेव की फोटो अपलोड करें", "समय सेट करें", "मंत्र और अलार्म चुनें", "नियमित अभ्यास करें"],
                    extraInfo: ""
                },
                english: {
                    mainTitle: "Method of Shidhdhayog Meditation:",
                    meditationSteps: ["Preparation: Sit in a quiet place, close your eyes", "Initiation Mantra: First, listen to Gurudev's initiation mantra", "Guru Darshan: Focus on Gurudev's photo", "Breathing: Breathe normally, keep your mind calm", "Surrender: Maintain a state of complete surrender"],
                    benefits: ["Mental peace", "Spiritual progress", "Increased concentration", "Stress relief"],
                    appUsage: ["Upload Gurudev's photo", "Set the time", "Choose mantra and alarm", "Practice regularly"],
                    extraInfo: ""
                }
            }
        };

        // --- TRANSLATIONS OBJECT ---
        const translations = {
            hindi: {
                appTitle: "🕉️ शिद्धयोग ध्यान", startButton: "🧘‍♂️ शुरू करें", infoButton: "ℹ️ कैसे करें", settingsButton: "⚙️ सेटिंग्स", adminButton: "👨‍💼 एडमिन पैनल",
                countdownText: "ध्यान शुरू होने में...", pause: "रोकें", play: "चलाएं", restart: "फिर शुरू करें", back: "वापस", skipTimer: "टाइमर स्किप",
                completionMessage: "🙏 ध्यान पूर्ण हुआ 🙏", finalBackButton: "वापस जाएं", okButton: "ठीक है", skipMantra: "⏭️ मंत्र स्किप",
                settingsTitle: "⚙️ सेटिंग्स", languageLabel: "भाषा", timeLabel: "ध्यान का समय (मिनट)", bgColorLabel: "ध्यान स्क्रीन का रंग", themeLabel: "थीम", settingsInfo: "मंत्र, अलार्म और गुरुदेव की फोटो पहले से ही सेट हैं।",
                howToTitle: "🧘‍♂️ ध्यान कैसे करें", gotItButton: "✅ समझ गया", adminPanelTitle: "👨‍💼 एडमिन पैनल", mainTitleLabel: "मुख्य शीर्षक", meditationStepsLabel: "ध्यान की विधि", benefitsLabel: "ध्यान के लाभ", appUsageLabel: "ऐप का उपयोग", extraInfoLabel: "अतिरिक्त जानकारी", saveButton: "💾 सेव करें", previewButton: "👁️ प्रीव्यू",
                restartConfirm: "क्या आप ध्यान फिर से शुरू करना चाहते हैं?", stopConfirm: "क्या आप वाकई ध्यान रोकना चाहते हैं?", confirmYes: "हाँ", confirmNo: "नहीं",
            },
            english: {
                appTitle: "🕉️ Shidhdhayog Meditation", startButton: "🧘‍♂️ Start", infoButton: "ℹ️ How To", settingsButton: "⚙️ Settings", adminButton: "👨‍💼 Admin Panel",
                countdownText: "Meditation starting in...", pause: "Pause", play: "Play", restart: "Restart", back: "Back", skipTimer: "Skip Timer",
                completionMessage: "🙏 Meditation Complete 🙏", finalBackButton: "Go Back", okButton: "OK", skipMantra: "⏭️ Skip Mantra",
                settingsTitle: "⚙️ Settings", languageLabel: "Language", timeLabel: "Meditation Time (minutes)", bgColorLabel: "Meditation Screen Color", themeLabel: "Theme", settingsInfo: "Mantra, alarm, and Gurudev's photo are pre-set.",
                howToTitle: "🧘‍♂️ How to Meditate", gotItButton: "✅ Got It", adminPanelTitle: "👨‍💼 Admin Panel", mainTitleLabel: "Main Title", meditationStepsLabel: "Meditation Steps", benefitsLabel: "Benefits", appUsageLabel: "App Usage", extraInfoLabel: "Extra Info", saveButton: "💾 Save", previewButton: "👁️ Preview",
                restartConfirm: "Do you want to restart the meditation?", stopConfirm: "Do you really want to stop the meditation?", confirmYes: "Yes", confirmNo: "No",
            }
        };

        // --- CORE FUNCTIONS ---
        function saveAppState() { try { localStorage.setItem('shidhdhayogAppState', JSON.stringify(appState)); } catch (e) { console.error("Could not save state:", e); } }
        function loadAppState() {
            const savedState = localStorage.getItem('shidhdhayogAppState');
            if (savedState) {
                try {
                    const loaded = JSON.parse(savedState);
                    Object.assign(appState, loaded);
                } catch (error) { console.error("Could not parse saved state:", error); }
            }
            document.getElementById('languageSelect').value = appState.language;
            document.getElementById('timeValue').textContent = appState.meditationTime;
            
            
            populateThemeSelector();
            applyTheme(appState.theme);
            updateUIText();
        }
        function updateUIText() {
            const lang = appState.language;
            document.querySelectorAll('[data-lang-key]').forEach(el => {
                const key = el.getAttribute('data-lang-key');
                if (translations[lang] && translations[lang][key]) {
                    el.innerHTML = translations[lang][key];
                }
            });
            updateInfoModal();
        }
        function changeLanguage(lang) {
            appState.language = lang;
            saveAppState();
            updateUIText();
        }
        function applyTheme(themeKey) { document.body.setAttribute('data-theme', themeKey); }
        function changeTheme(themeKey) {
            appState.theme = themeKey;
            applyTheme(themeKey);
            saveAppState();
        }
        function populateThemeSelector() {
            const selector = document.getElementById('themeSelect');
            selector.innerHTML = '';
            for (const key in themes) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = themes[key].name;
                selector.appendChild(option);
            }
            selector.value = appState.theme;
        }

        // --- MEDITATION FLOW ---
        function startMeditation() {
            document.getElementById('meditationScreen').style.backgroundColor = appState.meditationBgColor;
            document.getElementById('meditationScreen').style.display = 'flex';
            requestWakeLock();
            if (document.documentElement.requestFullscreen) { document.documentElement.requestFullscreen().catch(err => console.log(err)); }
            startMantra();
        }
        function startMantra() {
            updateVisibility('mantra');
            if (mantraAudio) {
                isMantraPlaying = true;
                mantraAudio.currentTime = 0;
                mantraAudio.onended = () => { if (isMantraPlaying) { isMantraPlaying = false; startCountdown(); } };
                mantraAudio.play().catch(error => { console.error("Audio play failed.", error); });
            } else { console.log("Mantra audio not loaded."); }
        }
        function skipMantra() {
            if (isMantraPlaying && mantraAudio) { mantraAudio.pause(); mantraAudio.currentTime = 0; }
            isMantraPlaying = false;
            startCountdown();
        }
        function startCountdown() {
            updateVisibility('countdown');
            let count = 5;
            document.getElementById('countdownNumber').textContent = count;
            countdownTimer = setInterval(() => {
                count--;
                if (count > 0) {
                    const el = document.getElementById('countdownNumber');
                    el.textContent = count;
                    el.style.animation = 'none';
                    setTimeout(() => { el.style.animation = 'pulse 1s ease-in-out'; }, 10);
                } else {
                    clearInterval(countdownTimer);
                    startMeditationTimer();
                }
            }, 1000);
        }
        function startMeditationTimer() {
            updateVisibility('meditating');
            totalSeconds = appState.meditationTime * 60;
            updateTimerDisplay(totalSeconds);
            isPaused = false;
            document.getElementById('pausePlayBtn').innerHTML = translations[appState.language].pause;
            meditationTimer = setInterval(() => {
                if (!isPaused) {
                    totalSeconds--;
                    updateTimerDisplay(totalSeconds);
                    if (totalSeconds <= 0) {
                        clearInterval(meditationTimer);
                        endMeditation();
                    }
                }
            }, 1000);
        }
        function endMeditation() {
            updateVisibility('finished');
            if (alarmAudio) {
                alarmAudio.loop = true;
                alarmAudio.play().catch(e => console.error("Alarm play failed:", e));
            }
        }

        // --- CONTROLS & UI ---
        function togglePausePlay() {
            isPaused = !isPaused;
            document.getElementById('pausePlayBtn').innerHTML = isPaused ? translations[appState.language].play : translations[appState.language].pause;
        }
        function restartMeditation() {
            showConfirmation('restartConfirm', () => { clearInterval(meditationTimer); startMeditationTimer(); });
        }
        function skipMeditationTimer() {
            if (totalSeconds > 0) { totalSeconds = 1; document.getElementById('skipButton').style.display = 'none'; }
        }
        function goBack(confirmFirst = true) {
            const doGoBack = () => {
                clearInterval(meditationTimer);
                clearInterval(countdownTimer);
                if (mantraAudio) { mantraAudio.pause(); mantraAudio.currentTime = 0; }
                if(alarmAudio) { alarmAudio.pause(); alarmAudio.currentTime = 0; alarmAudio.loop = false; }
                isMantraPlaying = false;
                meditationTimer = null;
                document.getElementById('meditationScreen').style.display = 'none';
                releaseWakeLock();
                if (document.exitFullscreen) { document.exitFullscreen(); }
            };
            if (confirmFirst && meditationTimer) { showConfirmation('stopConfirm', doGoBack); } 
            else { doGoBack(); }
        }
        function updateVisibility(state) {
            const medScreen = document.getElementById('meditationScreen');
            const countdownScreen = document.getElementById('countdownScreen');
            const mantraControls = document.getElementById('mantraControls');
            const meditationControls = document.querySelector('.meditation-controls');
            const timerDisplay = document.getElementById('timerDisplay');
            const endScreenMessage = document.getElementById('endScreenMessage');
            const finalControls = document.getElementById('finalControls');
            [countdownScreen, mantraControls, meditationControls, timerDisplay, endScreenMessage, finalControls].forEach(el => el.style.display = 'none');
            medScreen.classList.remove('controls-visible');
            switch(state) {
                case 'mantra': mantraControls.style.display = 'flex'; break;
                case 'countdown': countdownScreen.style.display = 'flex'; break;
                case 'meditating': meditationControls.style.display = 'flex'; timerDisplay.style.display = 'block'; break;
                case 'finished': endScreenMessage.style.display = 'block'; break;
                case 'final': finalControls.style.display = 'flex'; finalControls.style.opacity = '1'; finalControls.style.pointerEvents = 'auto'; break;
            }
        }

        // --- MODALS & SETTINGS ---
        function showModal(id) { const el = document.getElementById(id); el.style.display = 'flex'; setTimeout(() => el.classList.add('visible'), 10); }
        function closeModal(id) { const el = document.getElementById(id); el.classList.remove('visible'); setTimeout(() => el.style.display = 'none', 300); }
        function showSettings() { showModal('settingsModal'); }
        function closeSettings() { closeModal('settingsModal'); }
        function showInfo() { updateInfoModal(); showModal('infoModal'); }
        function closeInfo() { closeModal('infoModal'); }
        function showAdminPanel() { loadAdminData(); showModal('adminModal'); }
        function closeAdminPanel() { closeModal('adminModal'); }

        function updateTimerDisplay(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            document.getElementById('timerDisplay').textContent = `${String(minutes).padStart(2, '0')}:${String(remainingSeconds).padStart(2, '0')}`;
        }
        function updateInfoModal() {
            const lang = appState.language;
            const info = appState.customInfo[lang];
            if (!info) return;
            const infoContent = document.getElementById('infoContentDiv');
            let stepsHtml = info.meditationSteps.map(s => `<li>${s}</li>`).join('');
            let benefitsHtml = info.benefits.map(b => `<li>${b}</li>`).join('');
            let usageHtml = info.appUsage.map(u => `<li>${u}</li>`).join('');
            let extraSection = info.extraInfo ? `<h4>📝 ${lang === 'hindi' ? 'अतिरिक्त जानकारी:' : 'Extra Info:'}</h4><p>${info.extraInfo}</p>` : '';
            infoContent.innerHTML = `<h4>${info.mainTitle}</h4><ul>${stepsHtml}</ul><h4>🎯 ${lang === 'hindi' ? 'ध्यान के लाभ:' : 'Benefits:'}</h4><ul>${benefitsHtml}</ul><h4>📱 ${lang === 'hindi' ? 'ऐप का उपयोग:' : 'App Usage:'}</h4><ul>${usageHtml}</ul>${extraSection}`;
        }

        // --- UTILITY & EVENT LISTENERS ---
        let wakeLock = null;
        async function requestWakeLock() { if ('wakeLock' in navigator) { try { wakeLock = await navigator.wakeLock.request('screen'); } catch (err) { console.error(`${err.name}, ${err.message}`); } } }
        function releaseWakeLock() { if (wakeLock) { wakeLock.release().then(() => { wakeLock = null; }); } }

        let toastTimer;
function showToast(message) {
    const toast = document.getElementById('toastNotification');
    toast.textContent = message;
    toast.style.display = 'block';
    setTimeout(() => {
        toast.style.bottom = 'calc(20px + env(safe-area-inset-bottom))';
    }, 10); // Show with animation

    clearTimeout(toastTimer);
    toastTimer = setTimeout(() => {
        toast.style.bottom = '-100px';
        setTimeout(() => {
            toast.style.display = 'none';
        }, 500); // Hide after animation
    }, 3000); // Display for 3 seconds
}

function showConfirmation(messageKey, onConfirm) {
            const message = translations[appState.language][messageKey];
            const confirmModal = document.getElementById('confirmModal');
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('confirmYes').innerHTML = translations[appState.language].confirmYes;
            document.getElementById('confirmNo').innerHTML = translations[appState.language].confirmNo;
            showModal('confirmModal');
            const yesBtn = document.getElementById('confirmYes');
            const noBtn = document.getElementById('confirmNo');
            const handleYes = () => { onConfirm(); cleanup(); };
            const handleNo = () => { cleanup(); };
            const cleanup = () => { closeModal('confirmModal'); yesBtn.removeEventListener('click', handleYes); noBtn.removeEventListener('click', handleNo); };
            yesBtn.addEventListener('click', handleYes);
            noBtn.addEventListener('click', handleNo);
        }

        // --- ON LOAD ---
        window.addEventListener('load', function() {
            function initializeAppAssets() {
                const photoUrl = 'gurudev.jpg';
                document.getElementById('guruPhoto').innerHTML = `<img src="${photoUrl}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;" alt="गुरुदेव">`;
                document.getElementById('meditationPhoto').innerHTML = `<img src="${photoUrl}" alt="गुरुदेव">`;
                try {
                    mantraAudio = new Audio('mantra.mp3');
                    alarmAudio = new Audio('alarm.mp3');
                    mantraAudio.preload = 'auto';
                    alarmAudio.preload = 'auto';
                } catch (e) { console.error("Error loading audio:", e); }
            }
            
            loadAppState();
            initializeAppAssets();

            let titleClickCount = 0, titleClickTimer = null;
            document.querySelector('.app-title').addEventListener('click', () => {
                clearTimeout(titleClickTimer);
                titleClickCount++;
                if (titleClickCount >= 5) {
                    document.getElementById('adminButton').style.display = 'block';
                    titleClickCount = 0;
                }
                titleClickTimer = setTimeout(() => { titleClickCount = 0; }, 1500);
            });

            // ## यहाँ 7-टैप वाला कोड वापस जोड़ा गया है ##
            let tapCount = 0, tapTimer = null;
            document.getElementById('meditationScreen').addEventListener('click', function(event) {
                if (event.target.closest('.control-btn, .bottom-popup, .btn')) return;
                const medControls = document.querySelector('.meditation-controls');
                if (medControls.style.display === 'flex') {
                    this.classList.toggle('controls-visible');
                    clearTimeout(tapTimer);
                    tapCount++;
                    if (tapCount >= 7) {
                        document.getElementById('skipButton').style.display = 'flex';
                        tapCount = 0;
                    }
                    tapTimer = setTimeout(() => {
                        tapCount = 0;
                    }, 2000);
                }
            });

            document.getElementById('okButton').addEventListener('click', function() {
                if (alarmAudio) { alarmAudio.pause(); alarmAudio.currentTime = 0; alarmAudio.loop = false; }
                updateVisibility('final');
            });

            document.getElementById('timeDecrement').addEventListener('click', () => {
                let currentTime = parseInt(appState.meditationTime);
                if (currentTime > 1) { 
                    appState.meditationTime = currentTime - 1; 
                    document.getElementById('timeValue').textContent = appState.meditationTime;
                    saveAppState();
                }
            });
            document.getElementById('timeIncrement').addEventListener('click', () => {
                let currentTime = parseInt(appState.meditationTime);
                if (currentTime < 120) {
                    appState.meditationTime = currentTime + 1; 
                    document.getElementById('timeValue').textContent = appState.meditationTime;
                    saveAppState();
                }
            });
            // New function to create and manage the custom color picker
function initializeColorPicker() {
    const pickerContainer = document.getElementById('customColorPicker');
    pickerContainer.innerHTML = ''; // Clear previous swatches
    const colors = ['#000000', '#1a2a6c', '#2c3e50', '#0f2027', '#4a47a3', '#134e5e', '#364d41', '#2c3a61'];
    
    colors.forEach(color => {
        const swatch = document.createElement('div');
        swatch.className = 'color-swatch';
        swatch.style.backgroundColor = color;
        swatch.dataset.color = color;
        
        if (color === appState.meditationBgColor) {
            swatch.classList.add('selected');
        }
        
        swatch.addEventListener('click', () => {
            // Update app state
            appState.meditationBgColor = color;
            saveAppState();
            
            // Update UI
            pickerContainer.querySelector('.selected')?.classList.remove('selected');
            swatch.classList.add('selected');
        });
        
        pickerContainer.appendChild(swatch);
    });
}

// Initialize the color picker on load
initializeColorPicker();
        });
        
        // ## एडमिन पैनल के फंक्शन को ठीक कर दिया गया है ##
        function loadAdminData() { 
            const lang = appState.language;
            if (!appState.customInfo[lang]) {
                appState.customInfo[lang] = JSON.parse(JSON.stringify(appState.customInfo.english));
            }
            const info = appState.customInfo[lang];
            document.getElementById('adminMainTitle').value = info.mainTitle; 
            document.getElementById('adminMeditationSteps').value = info.meditationSteps.join('\n');
            document.getElementById('adminBenefits').value = info.benefits.join('\n');
            document.getElementById('adminAppUsage').value = info.appUsage.join('\n');
            document.getElementById('adminExtraInfo').value = info.extraInfo;
        } 
        function saveAdminSettings() { 
            const lang = appState.language;
            if (!appState.customInfo[lang]) {
                appState.customInfo[lang] = {};
            }
            appState.customInfo[lang].mainTitle = document.getElementById('adminMainTitle').value.trim(); 
            appState.customInfo[lang].meditationSteps = document.getElementById('adminMeditationSteps').value.split('\n').filter(s => s.trim());
            appState.customInfo[lang].benefits = document.getElementById('adminBenefits').value.split('\n').filter(b => b.trim());
            appState.customInfo[lang].appUsage = document.getElementById('adminAppUsage').value.split('\n').filter(u => u.trim());
            appState.customInfo[lang].extraInfo = document.getElementById('adminExtraInfo').value.trim();
            saveAppState(); 
            showToast(translations[lang].saveButton + (lang === 'hindi' ? " हो गया!" : " Saved!")); 
            closeAdminPanel();
            updateInfoModal();
        } 
        function previewInfo() {
    // Temporarily build the preview without saving to appState
    const lang = appState.language;
    const tempInfo = {
        mainTitle: document.getElementById('adminMainTitle').value.trim(),
        meditationSteps: document.getElementById('adminMeditationSteps').value.split('\n').filter(s => s.trim()),
        benefits: document.getElementById('adminBenefits').value.split('\n').filter(b => b.trim()),
        appUsage: document.getElementById('adminAppUsage').value.split('\n').filter(u => u.trim()),
        extraInfo: document.getElementById('adminExtraInfo').value.trim()
    };

    const infoContent = document.getElementById('infoContentDiv');
    let stepsHtml = tempInfo.meditationSteps.map(s => `<li>${s}</li>`).join('');
    let benefitsHtml = tempInfo.benefits.map(b => `<li>${b}</li>`).join('');
    let usageHtml = tempInfo.appUsage.map(u => `<li>${u}</li>`).join('');
    let extraSection = tempInfo.extraInfo ? `<h4>📝 ${lang === 'hindi' ? 'अतिरिक्त जानकारी:' : 'Extra Info:'}</h4><p>${tempInfo.extraInfo}</p>` : '';
    
    infoContent.innerHTML = `<h4>${tempInfo.mainTitle}</h4><ul>${stepsHtml}</ul><h4>🎯 ${lang === 'hindi' ? 'ध्यान के लाभ:' : 'Benefits:'}</h4><ul>${benefitsHtml}</ul><h4>📱 ${lang === 'hindi' ? 'ऐप का उपयोग:' : 'App Usage:'}</h4><ul>${usageHtml}</ul>${extraSection}`;
    
    showModal('infoModal');
}
    </script>
<!-- Custom Toast Notification -->
<div id="toastNotification" style="display: none; position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%); background: linear-gradient(45deg, #56ab2f, #a8e063); color: white; padding: 14px 28px; border-radius: 30px; z-index: 2000; box-shadow: 0 8px 25px rgba(0,0,0,0.3); transition: bottom 0.5s ease-in-out; font-weight: 600;"></div>

</body>
</html>