<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡§∂‡§ø‡§¶‡•ç‡§ß‡§Ø‡•ã‡§ó ‡§ß‡•ç‡§Ø‡§æ‡§® - Shidhdhayog Dhyan</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-attachment: fixed; min-height: 100vh; color: #333; overflow-x: hidden;
        }
        .container { max-width: 400px; margin: 0 auto; padding: 20px; text-align: center; }
        .app-title {
            color: white; font-size: 28px; margin-bottom: 20px; text-shadow: 3px 3px 8px rgba(0,0,0,0.4);
            font-weight: 600; letter-spacing: 1px; cursor: pointer; user-select: none;
        }
        .guru-photo-container {
            position: relative; width: 200px; height: 200px; margin: 0 auto 30px; border-radius: 50%;
            overflow: hidden; box-shadow: 0 15px 40px rgba(0,0,0,0.4), 0 0 0 4px rgba(255,255,255,0.1);
            transition: all 0.4s ease; background: #000;
        }
        .guru-photo-container:hover { transform: scale(1.05); box-shadow: 0 20px 50px rgba(0,0,0,0.5), 0 0 0 4px rgba(255,255,255,0.2); }
        .guru-photo { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 18px; color: #666; }
        .main-buttons { display: flex; gap: 15px; justify-content: center; margin-bottom: 20px; }
        .btn {
            padding: 16px 24px; border: none; border-radius: 30px; font-size: 16px; font-weight: bold;
            cursor: pointer; transition: all 0.4s ease; box-shadow: 0 6px 20px rgba(0,0,0,0.25);
            position: relative; overflow: hidden;
        }
        .btn::before {
            content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent); transition: left 0.5s ease;
        }
        .btn:hover::before { left: 100%; }
        .btn-start {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24, #ff7675); color: white;
            background-size: 200% 200%; animation: gradientShift 3s ease infinite;
        }
        .btn-start:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(238, 90, 36, 0.4); }
        @keyframes gradientShift { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .btn-info {
            background: linear-gradient(45deg, #74b9ff, #0984e3, #00cec9); color: white;
            background-size: 200% 200%; animation: gradientShift 4s ease infinite;
        }
        .btn-info:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(9, 132, 227, 0.4); }
        .btn-settings {
            background: linear-gradient(45deg, #a29bfe, #6c5ce7, #fd79a8); color: white;
            width: 100%; margin-bottom: 20px; background-size: 200% 200%; animation: gradientShift 5s ease infinite;
        }
        .btn-settings:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(108, 92, 231, 0.4); }
        #adminButton { display: none; }
        .meditation-screen {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: #000;
            display: none; flex-direction: column; align-items: center; justify-content: center; 
            z-index: 1000;
        }
        .meditation-photo { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: #666; font-size: 18px; background: #000; }
        .meditation-photo img { max-width: 100%; max-height: 100%; object-fit: contain; }
        .timer-display {
            position: absolute; bottom: 120px; left: 50%; transform: translateX(-50%); z-index: 10; font-size: 28px;
            background: rgba(0,0,0,0.4); padding: 8px 20px; border-radius: 20px; color: rgba(255,255,255,0.9);
            font-family: 'Courier New', monospace; letter-spacing: 2px; opacity: 0; pointer-events: none; transition: opacity 0.5s ease;
        }
        .meditation-controls {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 10;
            display: flex; gap: 10px; opacity: 0; pointer-events: none; transition: opacity 0.5s ease;
        }
        .meditation-screen.controls-visible .timer-display,
        .meditation-screen.controls-visible .meditation-controls { opacity: 1; pointer-events: auto; }
        .control-btn {
            padding: 12px 18px; font-size: 16px; border-radius: 25px; background: rgba(255,255,255,0.15);
            border: 1px solid rgba(255,255,255,0.3); color: white; cursor: pointer; backdrop-filter: blur(10px);
            transition: all 0.4s ease; min-width: 80px; font-weight: 500;
        }
        .control-btn:hover { background: rgba(255,255,255,0.25); transform: translateY(-2px); }
        .countdown-screen {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: linear-gradient(45deg, #667eea, #764ba2, #667eea); background-size: 400% 400%;
            animation: gradientMove 3s ease infinite; display: none; flex-direction: column;
            align-items: center; justify-content: center; z-index: 1001;
        }
        @keyframes gradientMove { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .countdown-number { font-size: 130px; color: white; font-weight: bold; text-shadow: 4px 4px 15px rgba(0,0,0,0.4); animation: pulse 1s ease-in-out; }
        @keyframes pulse { 0% { transform: scale(0.7); opacity: 0.4; } 50% { transform: scale(1.3); opacity: 1; } 100% { transform: scale(1); opacity: 1; } }
        .modal {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.6);
            display: none; align-items: center; justify-content: center; z-index: 1002; backdrop-filter: blur(5px);
        }
        .modal-content {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%); padding: 30px; border-radius: 20px;
            max-width: 350px; width: 90%; max-height: 80vh; overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3); transform: scale(0.9); opacity: 0; transition: all 0.3s ease;
        }
        .modal.visible .modal-content { transform: scale(1); opacity: 1; }
        .modal h3 { margin-bottom: 20px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 5px; color: #666; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; }
        .info-content { text-align: left; line-height: 1.6; }
        .info-content h4 { margin: 15px 0 10px 0; color: #667eea; }
        .info-content ul { margin-left: 20px; list-style-position: inside; }
        #confirmMessage { font-size: 18px; margin-bottom: 25px; text-align: center; }
        .confirm-buttons { display: flex; gap: 15px; }
        .confirm-buttons .btn { flex: 1; }
        /* --- NEW: Language Switcher Styles --- */
        .language-switcher { display: flex; gap: 10px; justify-content: center; margin-bottom: 30px; }
        .lang-btn {
            background: rgba(255, 255, 255, 0.15); border: 1px solid rgba(255, 255, 255, 0.3);
            color: white; padding: 8px 16px; border-radius: 20px; cursor: pointer; transition: all 0.3s ease;
        }
        .lang-btn.active { background: white; color: #6c5ce7; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="app-title">üïâÔ∏è ‡§∂‡§ø‡§¶‡•ç‡§ß‡§Ø‡•ã‡§ó ‡§ß‡•ç‡§Ø‡§æ‡§®</h1>

        <!-- NEW: Language Switcher -->
        <div class="language-switcher">
            <button class="lang-btn" id="langBtnHindi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</button>
            <button class="lang-btn" id="langBtnEnglish">English</button>
        </div>

        <div class="guru-photo-container">
            <div class="guru-photo" id="guruPhoto"></div>
        </div>
        <div class="main-buttons">
            <button class="btn btn-start" id="startBtn">üßò‚Äç‚ôÇÔ∏è ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç</button>
            <button class="btn btn-info" id="howToBtn">‚ÑπÔ∏è ‡§ï‡•à‡§∏‡•á ‡§ï‡§∞‡•á‡§Ç</button>
        </div>
        <button class="btn btn-settings" id="settingsBtn">‚öôÔ∏è ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏</button>
        <button id="adminButton" class="btn btn-settings" onclick="showAdminPanel()" style="background: linear-gradient(45deg, #e17055, #d63031); margin-top: 10px;">üë®‚Äçüíº Admin Panel</button>
    </div>

    <div class="countdown-screen" id="countdownScreen">
        <div class="countdown-number" id="countdownNumber">5</div>
        <div style="color: white; margin-top: 30px; font-size: 18px;" id="countdownText">‡§ß‡•ç‡§Ø‡§æ‡§® ‡§∂‡•Å‡§∞‡•Ç ‡§π‡•ã‡§®‡•á ‡§Æ‡•á‡§Ç...</div>
    </div>

    <div class="meditation-screen" id="meditationScreen">
        <div class="meditation-photo" id="meditationPhoto"></div>
        <div class="timer-display" id="timerDisplay">15:00</div>
        <div class="meditation-controls">
            <!-- Buttons now have IDs and no text, JS will add it -->
            <button class="control-btn" id="pausePlayBtn"></button>
            <button class="control-btn" id="restartBtn"></button>
            <button class="control-btn" id="backBtn"></button>
        </div>
    </div>
    
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <h3 id="settingsTitle">‚öôÔ∏è ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏</h3>
            <div class="form-group">
                <label id="meditationTimeLabel">‡§ß‡•ç‡§Ø‡§æ‡§® ‡§ï‡§æ ‡§∏‡§Æ‡§Ø (‡§Æ‡§ø‡§®‡§ü)</label>
                <select id="meditationTime">
                    <option value="5">5 ‡§Æ‡§ø‡§®‡§ü</option> <option value="10">10 ‡§Æ‡§ø‡§®‡§ü</option> <option value="15" selected>15 ‡§Æ‡§ø‡§®‡§ü</option>
                    <option value="20">20 ‡§Æ‡§ø‡§®‡§ü</option> <option value="30">30 ‡§Æ‡§ø‡§®‡§ü</option> <option value="45">45 ‡§Æ‡§ø‡§®‡§ü</option> <option value="60">60 ‡§Æ‡§ø‡§®‡§ü</option>
                </select>
            </div>
            <div style="text-align: center; color: #777; margin-top: 20px;"><p id="presetInfo">‡§Æ‡§Ç‡§§‡•ç‡§∞, ‡§Ö‡§≤‡§æ‡§∞‡•ç‡§Æ ‡§î‡§∞ ‡§ó‡•Å‡§∞‡•Å‡§¶‡•á‡§µ ‡§ï‡•Ä ‡§´‡•ã‡§ü‡•ã ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§π‡•Ä ‡§∏‡•á‡§ü ‡§π‡•à‡§Ç‡•§</p></div>
            <div style="display: flex; gap: 10px; margin-top: 30px;">
                <button class="btn btn-start" id="saveSettingsBtn" style="flex: 1;">üíæ ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç</button>
                <button class="btn btn-info" id="closeSettingsBtn" style="flex: 1;">‚ùå ‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
            </div>
        </div>
    </div>

    <div class="modal" id="infoModal">
         <div class="modal-content">
            <h3 id="infoTitle">üßò‚Äç‚ôÇÔ∏è ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§ï‡•à‡§∏‡•á ‡§ï‡§∞‡•á‡§Ç</h3>
            <div class="info-content" id="infoContentDiv"></div>
            <button class="btn btn-info" id="understandBtn" style="width: 100%; margin-top: 20px;">‚úÖ ‡§∏‡§Æ‡§ù ‡§ó‡§Ø‡§æ</button>
         </div>
    </div>

    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <p id="confirmMessage">‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§π‡•à‡§Ç?</p>
            <div class="confirm-buttons">
                <button id="confirmYes" class="btn btn-start"></button>
                <button id="confirmNo" class="btn btn-info"></button>
            </div>
        </div>
    </div>

    <script>
        // --- ELEMENTS ---
        const $ = (id) => document.getElementById(id);
        const startBtn = $('startBtn'), howToBtn = $('howToBtn'), settingsBtn = $('settingsBtn');
        const pausePlayBtn = $('pausePlayBtn'), restartBtn = $('restartBtn'), backBtn = $('backBtn');
        
        // --- GLOBAL VARIABLES ---
        let meditationTimer, countdownTimer, mantraAudio, alarmAudio;
        let isMantraPlaying = false, isPaused = false, totalSeconds;
        
        const appState = {
            meditationTime: 15,
            language: 'hindi',
            customInfo: {
                mainTitle: "‡§∂‡§ø‡§¶‡•ç‡§ß‡§Ø‡•ã‡§ó ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§ï‡•Ä ‡§µ‡§ø‡§ß‡§ø:",
                meditationSteps: ["‡§§‡•à‡§Ø‡§æ‡§∞‡•Ä: ‡§∂‡§æ‡§Ç‡§§ ‡§∏‡•ç‡§•‡§æ‡§® ‡§™‡§∞ ‡§¨‡•à‡§†‡•á‡§Ç, ‡§Ü‡§Ç‡§ñ‡•á‡§Ç ‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç", "‡§¶‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§Æ‡§Ç‡§§‡•ç‡§∞: ‡§™‡§π‡§≤‡•á ‡§ó‡•Å‡§∞‡•Å‡§¶‡•á‡§µ ‡§ï‡§æ ‡§¶‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§Æ‡§Ç‡§§‡•ç‡§∞ ‡§∏‡•Å‡§®‡•á‡§Ç", "‡§ó‡•Å‡§∞‡•Å ‡§¶‡§∞‡•ç‡§∂‡§®: ‡§ó‡•Å‡§∞‡•Å‡§¶‡•á‡§µ ‡§ï‡•Ä ‡§´‡•ã‡§ü‡•ã ‡§™‡§∞ ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç", "‡§∂‡•ç‡§µ‡§æ‡§∏: ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§≤‡•á‡§Ç, ‡§Æ‡§® ‡§ï‡•ã ‡§∂‡§æ‡§Ç‡§§ ‡§∞‡§ñ‡•á‡§Ç", "‡§∏‡§Æ‡§∞‡•ç‡§™‡§£: ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∏‡§Æ‡§∞‡•ç‡§™‡§£ ‡§≠‡§æ‡§µ ‡§∞‡§ñ‡•á‡§Ç"],
                benefits: ["‡§Æ‡§æ‡§®‡§∏‡§ø‡§ï ‡§∂‡§æ‡§Ç‡§§‡§ø", "‡§Ü‡§ß‡•ç‡§Ø‡§æ‡§§‡•ç‡§Æ‡§ø‡§ï ‡§â‡§®‡•ç‡§®‡§§‡§ø", "‡§è‡§ï‡§æ‡§ó‡•ç‡§∞‡§§‡§æ ‡§Æ‡•á‡§Ç ‡§µ‡•É‡§¶‡•ç‡§ß‡§ø", "‡§§‡§®‡§æ‡§µ ‡§Æ‡•Å‡§ï‡•ç‡§§‡§ø"],
                appUsage: ["‡§ó‡•Å‡§∞‡•Å‡§¶‡•á‡§µ ‡§ï‡•Ä ‡§´‡•ã‡§ü‡•ã ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç", "‡§∏‡§Æ‡§Ø ‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç", "‡§Æ‡§Ç‡§§‡•ç‡§∞ ‡§î‡§∞ ‡§Ö‡§≤‡§æ‡§∞‡•ç‡§Æ ‡§ö‡•Å‡§®‡•á‡§Ç", "‡§®‡§ø‡§Ø‡§Æ‡§ø‡§§ ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç"],
                extraInfo: ""
            }
        };

        const translations = {
            hindi: {
                start: "üßò‚Äç‚ôÇÔ∏è ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç", howTo: "‚ÑπÔ∏è ‡§ï‡•à‡§∏‡•á ‡§ï‡§∞‡•á‡§Ç", settings: "‚öôÔ∏è ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏",
                countdown: "‡§ß‡•ç‡§Ø‡§æ‡§® ‡§∂‡•Å‡§∞‡•Ç ‡§π‡•ã‡§®‡•á ‡§Æ‡•á‡§Ç...",
                pause: "‡§∞‡•ã‡§ï‡•á‡§Ç", play: "‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç", restart: "‡§´‡§ø‡§∞ ‡§∏‡•á", back: "‡§µ‡§æ‡§™‡§∏",
                meditationTime: "‡§ß‡•ç‡§Ø‡§æ‡§® ‡§ï‡§æ ‡§∏‡§Æ‡§Ø (‡§Æ‡§ø‡§®‡§ü)", presetInfo: "‡§Æ‡§Ç‡§§‡•ç‡§∞, ‡§Ö‡§≤‡§æ‡§∞‡•ç‡§Æ ‡§î‡§∞ ‡§ó‡•Å‡§∞‡•Å‡§¶‡•á‡§µ ‡§ï‡•Ä ‡§´‡•ã‡§ü‡•ã ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§π‡•Ä ‡§∏‡•á‡§ü ‡§π‡•à‡§Ç‡•§",
                save: "üíæ ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç", close: "‚ùå ‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç", infoTitle: "üßò‚Äç‚ôÇÔ∏è ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§ï‡•à‡§∏‡•á ‡§ï‡§∞‡•á‡§Ç", understand: "‚úÖ ‡§∏‡§Æ‡§ù ‡§ó‡§Ø‡§æ",
                restartConfirm: "‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§´‡§ø‡§∞ ‡§∏‡•á ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?", stopConfirm: "‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§µ‡§æ‡§ï‡§à ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§∞‡•ã‡§ï‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?",
                confirmYes: "‡§π‡§æ‡§Å", confirmNo: "‡§®‡§π‡•Ä‡§Ç",
                meditationComplete: "üôè ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§π‡•Å‡§Ü! ‡§ó‡•Å‡§∞‡•Å‡§¶‡•á‡§µ ‡§ï‡§æ ‡§Ü‡§∂‡•Ä‡§∞‡•ç‡§µ‡§æ‡§¶ ‡§Ü‡§™ ‡§™‡§∞ ‡§¨‡§®‡§æ ‡§∞‡§π‡•á‡•§"
            },
            english: {
                start: "üßò‚Äç‚ôÇÔ∏è Start", howTo: "‚ÑπÔ∏è How To", settings: "‚öôÔ∏è Settings",
                countdown: "Meditation is starting...",
                pause: "Pause", play: "Play", restart: "Restart", back: "Back",
                meditationTime: "Meditation Time (minutes)", presetInfo: "Mantra, alarm, and Gurudev's photo are preset.",
                save: "üíæ Save", close: "‚ùå Close", infoTitle: "üßò‚Äç‚ôÇÔ∏è How to Meditate", understand: "‚úÖ Understood",
                restartConfirm: "Do you want to restart the meditation?", stopConfirm: "Do you really want to stop the meditation?",
                confirmYes: "Yes", confirmNo: "No",
                meditationComplete: "üôè Meditation complete! May Gurudev's blessings be upon you."
            }
        };

        // --- NEW: Function to update all UI text based on language ---
        function updateUIText(lang) {
            const t = translations[lang];
            startBtn.innerHTML = t.start;
            howToBtn.innerHTML = t.howTo;
            settingsBtn.innerHTML = t.settings;
            $('countdownText').innerText = t.countdown;
            pausePlayBtn.innerText = isPaused ? t.play : t.pause;
            restartBtn.innerText = t.restart;
            backBtn.innerText = t.back;
            $('settingsTitle').innerText = t.settings;
            $('meditationTimeLabel').innerText = t.meditationTime;
            $('presetInfo').innerText = t.presetInfo;
            $('saveSettingsBtn').innerHTML = t.save;
            $('closeSettingsBtn').innerHTML = t.close;
            $('infoTitle').innerText = t.infoTitle;
            $('understandBtn').innerHTML = t.understand;
            $('langBtnHindi').classList.toggle('active', lang === 'hindi');
            $('langBtnEnglish').classList.toggle('active', lang === 'english');
            document.documentElement.lang = lang;
        }

        function saveAppState() { try { localStorage.setItem('shidhdhayogAppState', JSON.stringify(appState)); } catch (e) { console.error(e); } }
        function loadAppState() {
            const savedState = localStorage.getItem('shidhdhayogAppState');
            if (savedState) {
                try {
                    const loadedState = JSON.parse(savedState);
                    Object.assign(appState, loadedState);
                } catch (error) { console.error("Could not parse saved state:", error); }
            }
            $('meditationTime').value = appState.meditationTime;
        }

        function showConfirmation(messageKey, onConfirm) {
            const t = translations[appState.language];
            const message = t[messageKey];
            $('confirmMessage').textContent = message;
            $('confirmYes').textContent = t.confirmYes;
            $('confirmNo').textContent = t.confirmNo;
            
            showModal('confirmModal');
            const yesBtn = $('confirmYes'), noBtn = $('confirmNo');
            const handleYes = () => { onConfirm(); cleanup(); };
            const handleNo = () => { cleanup(); };
            const cleanup = () => { closeModal('confirmModal'); yesBtn.removeEventListener('click', handleYes); noBtn.removeEventListener('click', handleNo); };
            yesBtn.addEventListener('click', handleYes, { once: true });
            noBtn.addEventListener('click', handleNo, { once: true });
        }
        
        function startMeditation() {
            $('meditationScreen').style.display = 'flex';
            requestWakeLock();
            if (document.documentElement.requestFullscreen) { document.documentElement.requestFullscreen().catch(err => console.log(err)); }
            // For now, skipping mantra to simplify: startCountdown();
            startCountdown();
        }

        function startCountdown() {
            const countdownScreen = $('countdownScreen');
            const countdownNumber = $('countdownNumber');
            countdownScreen.style.display = 'flex'; let count = 5; countdownNumber.textContent = count;
            countdownTimer = setInterval(() => {
                count--;
                if (count > 0) { countdownNumber.textContent = count; countdownNumber.style.animation = 'none'; setTimeout(() => { countdownNumber.style.animation = 'pulse 1s ease-in-out'; }, 10); } 
                else { clearInterval(countdownTimer); countdownScreen.style.display = 'none'; startMeditationTimer(); }
            }, 1000);
        }

        function startMeditationTimer() {
            totalSeconds = appState.meditationTime * 60;
            updateTimerDisplay(totalSeconds);
            isPaused = false;
            updateUIText(appState.language); // Update pause/play button text
            meditationTimer = setInterval(() => {
                if (!isPaused) {
                    totalSeconds--;
                    updateTimerDisplay(totalSeconds);
                    if (totalSeconds <= 0) { clearInterval(meditationTimer); endMeditation(); }
                }
            }, 1000);
        }

        function endMeditation() { 
            if (alarmAudio) { alarmAudio.play(); } 
            setTimeout(() => { 
                alert(translations[appState.language].meditationComplete);
                goBack(false); 
            }, 1000); 
        }
        
        function togglePausePlay() { 
            isPaused = !isPaused; 
            updateUIText(appState.language); // Update button text
        }
        
        function restartMeditation() { showConfirmation('restartConfirm', () => { clearInterval(meditationTimer); startMeditationTimer(); }); }
        
        function goBack(confirmFirst = true) {
            const doGoBack = () => {
                clearInterval(meditationTimer); clearInterval(countdownTimer);
                if (mantraAudio) { mantraAudio.pause(); mantraAudio.currentTime = 0; }
                $('meditationScreen').style.display = 'none';
                $('countdownScreen').style.display = 'none';
                releaseWakeLock();
                if (document.exitFullscreen) { document.exitFullscreen(); }
            };
            if (confirmFirst && totalSeconds > 0) { showConfirmation('stopConfirm', doGoBack); } else { doGoBack(); }
        }

        function showModal(modalId) { const modal = $(modalId); modal.style.display = 'flex'; setTimeout(() => modal.classList.add('visible'), 10); }
        function closeModal(modalId) { const modal = $(modalId); modal.classList.remove('visible'); setTimeout(() => modal.style.display = 'none', 300); }
        
        function updateTimerDisplay(seconds) { const minutes = Math.floor(seconds / 60); const remainingSeconds = seconds % 60; $('timerDisplay').textContent = `${String(minutes).padStart(2, '0')}:${String(remainingSeconds).padStart(2, '0')}`; }
        
        function saveSettings() {
            appState.meditationTime = parseInt($('meditationTime').value);
            saveAppState();
            alert("Settings saved! üéâ");
            closeModal('settingsModal');
        }
        
        function updateInfoModal() { const infoContent = $('infoContentDiv'); let stepsHtml = appState.customInfo.meditationSteps.map(s => `<li>${s}</li>`).join(''); let benefitsHtml = appState.customInfo.benefits.map(b => `<li>${b}</li>`).join(''); let usageHtml = appState.customInfo.appUsage.map(u => `<li>${u}</li>`).join(''); let extraSection = appState.customInfo.extraInfo ? `<h4>üìù ‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä:</h4><p>${appState.customInfo.extraInfo}</p>` : ''; infoContent.innerHTML = `<h4>${appState.customInfo.mainTitle}</h4><ul>${stepsHtml}</ul><h4>üéØ ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§ï‡•á ‡§≤‡§æ‡§≠:</h4><ul>${benefitsHtml}</ul><h4>üì± ‡§ê‡§™ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó:</h4><ul>${usageHtml}</ul>${extraSection}`; }
        function loadAdminData() { $('adminMainTitle').value = appState.customInfo.mainTitle; $('adminMeditationSteps').value = appState.customInfo.meditationSteps.join('\n'); $('adminBenefits').value = appState.customInfo.benefits.join('\n'); $('adminAppUsage').value = appState.customInfo.appUsage.join('\n'); $('adminExtraInfo').value = appState.customInfo.extraInfo; }
        function saveAdminSettings() { appState.customInfo.mainTitle = $('adminMainTitle').value.trim(); appState.customInfo.meditationSteps = $('adminMeditationSteps').value.split('\n').filter(s => s.trim()); appState.customInfo.benefits = $('adminBenefits').value.split('\n').filter(b => b.trim()); appState.customInfo.appUsage = $('adminAppUsage').value.split('\n').filter(u => u.trim()); appState.customInfo.extraInfo = $('adminExtraInfo').value.trim(); saveAppState(); alert("‚úÖ Admin settings saved!"); closeModal('adminModal'); }
        
        let wakeLock = null;
        async function requestWakeLock() { if ('wakeLock' in navigator) { try { wakeLock = await navigator.wakeLock.request('screen'); } catch (err) { console.error(err); } } }
        function releaseWakeLock() { if (wakeLock) { wakeLock.release().then(() => { wakeLock = null; }); } }
        
        // --- EVENT LISTENERS ---
        startBtn.addEventListener('click', startMeditation);
        howToBtn.addEventListener('click', () => { updateInfoModal(); showModal('infoModal'); });
        settingsBtn.addEventListener('click', () => showModal('settingsModal'));
        $('closeSettingsBtn').addEventListener('click', () => closeModal('settingsModal'));
        $('saveSettingsBtn').addEventListener('click', saveSettings);
        $('understandBtn').addEventListener('click', () => closeModal('infoModal'));
        pausePlayBtn.addEventListener('click', togglePausePlay);
        restartBtn.addEventListener('click', restartMeditation);
        backBtn.addEventListener('click', goBack);
        
        $('meditationScreen').addEventListener('click', function(e) { if(e.target === this) this.classList.toggle('controls-visible'); });
        
        // --- Language Switcher Logic ---
        function setLanguage(lang) {
            appState.language = lang;
            saveAppState();
            updateUIText(lang);
        }
        $('langBtnHindi').addEventListener('click', () => setLanguage('hindi'));
        $('langBtnEnglish').addEventListener('click', () => setLanguage('english'));

        window.addEventListener('load', function() {
            function initializeAppAssets() {
                const photoUrl = 'gurudev.jpg';
                const guruPhotoHTML = `<img src="${photoUrl}" style="width: 100%; height: 100%; object-fit: cover;" alt="‡§ó‡•Å‡§∞‡•Å‡§¶‡•á‡§µ">`;
                const meditationPhotoHTML = `<img src="${photoUrl}" alt="‡§ó‡•Å‡§∞‡•Å‡§¶‡•á‡§µ">`;
                $('guruPhoto').innerHTML = guruPhotoHTML;
                $('meditationPhoto').innerHTML = meditationPhotoHTML;
                
                try {
                    // Temporarily disable audio to prevent errors if files are missing
                    // mantraAudio = new Audio('mantra.mp3');
                    alarmAudio = new Audio('alarm.mp3');
                    // mantraAudio.preload = 'auto';
                    alarmAudio.preload = 'auto';
                } catch (e) {
                    console.error("Error loading audio files:", e);
                }
            }
            
            loadAppState(); 
            initializeAppAssets();
            updateInfoModal();
            updateUIText(appState.language); // Set initial text
            
            let titleClickCount = 0, titleClickTimer = null;
            document.querySelector('.app-title').addEventListener('click', () => { 
                clearTimeout(titleClickTimer); 
                titleClickCount++; 
                if (titleClickCount >= 5) { 
                    $('adminButton').style.display = 'block'; 
                    titleClickCount = 0; 
                } 
                titleClickTimer = setTimeout(() => { titleClickCount = 0; }, 1500); 
            });
        });
    </script>
</body>
</html>