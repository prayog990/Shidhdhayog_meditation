<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>‡§∂‡§ø‡§¶‡•ç‡§ß‡§Ø‡•ã‡§ó ‡§ß‡•ç‡§Ø‡§æ‡§® - Shidhdhayog Dhyan</title>
    <style>
        :root, body[data-theme="default-dark"] {
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --app-title-color: #ffffff;
            --btn-text-color: #ffffff;
            --primary-btn-bg: linear-gradient(45deg, #ff6b6b, #ee5a24);
            --secondary-btn-bg: linear-gradient(45deg, #74b9ff, #0984e3);
            --tertiary-btn-bg: linear-gradient(45deg, #a29bfe, #6c5ce7);
            --modal-bg: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            --modal-text-color: #343a40;
            --modal-header-color: #667eea;
            --meditation-screen-bg: #000000;
            --control-btn-bg: rgba(255, 255, 255, 0.15);
            --control-btn-border: rgba(255, 255, 255, 0.3);
            --timer-bg: rgba(0, 0, 0, 0.5);
            --timer-text: #ffffff;
            --bottom-popup-bg: rgba(40, 40, 40, 0.85);
        }
        /* Other themes */
        body[data-theme="night-sky"]{--bg-gradient:linear-gradient(135deg,#0f2027 0%,#203a43 50%,#2c5364 100%);--primary-btn-bg:linear-gradient(45deg,#DA4453,#89216B);--secondary-btn-bg:linear-gradient(45deg,#1D4350,#A43931);--tertiary-btn-bg:linear-gradient(45deg,#4776E6,#8E54E9);--modal-bg:linear-gradient(135deg,#2c3e50 0%,#34495e 100%);--modal-text-color:#ecf0f1;--modal-header-color:#1abc9c}body[data-theme="deep-forest"]{--bg-gradient:linear-gradient(135deg,#134E5E 0%,#71B280 100%);--primary-btn-bg:linear-gradient(45deg,#ff8008,#ffc837);--secondary-btn-bg:linear-gradient(45deg,#009688,#4CAF50);--tertiary-btn-bg:linear-gradient(45deg,#603813,#b29f94);--modal-bg:linear-gradient(135deg,#364d41 0%,#4a6857 100%);--modal-text-color:#f2f2f2;--modal-header-color:#ffc837}body[data-theme="sunrise"]{--bg-gradient:linear-gradient(135deg,#ff9a9e 0%,#fad0c4 99%,#fad0c4 100%);--app-title-color:#4a47a3;--btn-text-color:#ffffff;--primary-btn-bg:linear-gradient(45deg,#ff758c,#ff7eb3);--secondary-btn-bg:linear-gradient(45deg,#f093fb,#f5576c);--tertiary-btn-bg:linear-gradient(45deg,#a18cd1,#fbc2eb);--modal-bg:linear-gradient(135deg,#ffffff 0%,#fefefe 100%);--modal-text-color:#555;--modal-header-color:#ff758c}body[data-theme="mint"]{--bg-gradient:linear-gradient(135deg,#a1c4fd 0%,#c2e9fb 100%);--app-title-color:#07455d;--primary-btn-bg:linear-gradient(45deg,#56ab2f,#a8e063);--secondary-btn-bg:linear-gradient(45deg,#00B4DB,#0083B0);--tertiary-btn-bg:linear-gradient(45deg,#6190E8,#A7BFE8);--modal-bg:linear-gradient(135deg,#ffffff 0%,#f8fdff 100%);--modal-text-color:#333;--modal-header-color:#0083B0}body[data-theme="peaceful-lilac"]{--bg-gradient:linear-gradient(135deg,#e0c3fc 0%,#8ec5fc 100%);--app-title-color:#2c3a61;--primary-btn-bg:linear-gradient(45deg,#89f7fe,#66a6ff);--secondary-btn-bg:linear-gradient(45deg,#ffdde1,#ee9ca7);--tertiary-btn-bg:linear-gradient(45deg,#d4a5a5,#ffa3a3);--modal-bg:linear-gradient(135deg,#ffffff 0%,#fdfcff 100%);--modal-text-color:#444;--modal-header-color:#89f7fe}

        /* --- Global Styles --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg-gradient); background-attachment: fixed; min-height: 100vh; color: #333; overflow-x: hidden; transition: background 0.5s ease-in-out; }
        .container { max-width: 400px; margin: 0 auto; padding: 20px; text-align: center; }
        .app-title { color: var(--app-title-color); font-size: 28px; margin-bottom: 15px; text-shadow: 3px 3px 8px rgba(0,0,0,0.4); font-weight: 600; letter-spacing: 1px; user-select: none; }
        .meditation-counter { color: var(--app-title-color); font-size: 16px; margin-bottom: 20px; opacity: 0.8; }
        .guru-photo-container { position: relative; width: 200px; height: 200px; margin: 0 auto 30px; border-radius: 50%; overflow: hidden; box-shadow: 0 15px 40px rgba(0,0,0,0.4), 0 0 0 4px rgba(255,255,255,0.1); cursor: default; transition: all 0.4s ease; background: #000; }
        .guru-photo-container:hover { transform: scale(1.05); box-shadow: 0 20px 50px rgba(0,0,0,0.5), 0 0 0 4px rgba(255,255,255,0.2); }
        .guru-photo { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 18px; color: #666; }
        .main-buttons { display: flex; gap: 15px; justify-content: center; margin-bottom: 30px; }
        .btn { padding: 16px 28px; border: none; border-radius: 30px; font-size: 16px; font-weight: bold; cursor: pointer; transition: all 0.4s ease; box-shadow: 0 6px 20px rgba(0,0,0,0.25); position: relative; overflow: hidden; color: var(--btn-text-color); }
        .btn::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent); transition: left 0.5s ease; }
        .btn:hover::before { left: 100%; }
        .btn-start { background: var(--primary-btn-bg); }
        .btn-info { background: var(--secondary-btn-bg); }
        .btn-settings { background: var(--tertiary-btn-bg); width: 100%; margin-bottom: 20px; }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(0,0,0,0.3); }
        #adminButton { display: none; } /* Hide by default */
        
        /* Other component styles... */
        .meditation-screen{position:fixed;top:0;left:0;width:100vw;height:100vh;background:var(--meditation-screen-bg);display:none;flex-direction:column;align-items:center;justify-content:center;z-index:1000;cursor:default}.meditation-photo{width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:#666;font-size:18px;background:transparent}.meditation-photo img{max-width:100%;max-height:100%;object-fit:contain}.timer-display{position:absolute;top:40px;left:50%;transform:translateX(-50%);z-index:10;font-size:28px;background:var(--timer-bg);color:var(--timer-text);padding:8px 20px;border-radius:20px;font-weight:300;text-shadow:1px 1px 5px rgba(0,0,0,0.6);font-family:'Courier New',monospace;letter-spacing:2px;opacity:0;pointer-events:none;transition:opacity .5s ease}.meditation-controls{position:absolute;bottom:calc(30px + env(safe-area-inset-bottom));left:50%;transform:translateX(-50%);z-index:10;display:flex;gap:20px;opacity:0;pointer-events:none;transition:opacity .5s ease,bottom .3s ease}.meditation-screen.controls-visible .timer-display,.meditation-screen.controls-visible .meditation-controls{opacity:1;pointer-events:auto}.control-btn{padding:12px 25px;border-radius:30px;font-size:16px;font-weight:600;min-width:100px;text-align:center;background:var(--control-btn-bg);border:1px solid var(--control-btn-border);color:white;cursor:pointer;backdrop-filter:blur(10px);transition:all .4s ease;text-shadow:1px 1px 3px rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center}.control-btn:hover{background:rgba(255,255,255,0.25);border-color:rgba(255,255,255,0.6);transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,0,0,0.3)}.countdown-screen{position:fixed;top:0;left:0;width:100vw;height:100vh;background:var(--bg-gradient);display:none;flex-direction:column;align-items:center;justify-content:center;z-index:1001}.countdown-number{font-size:130px;color:white;font-weight:bold;text-shadow:4px 4px 15px rgba(0,0,0,0.4);animation:pulse 1s ease-in-out;font-family:'Segoe UI',sans-serif}@keyframes pulse{0%{transform:scale(0.7);opacity:0.4}50%{transform:scale(1.3);opacity:1;text-shadow:6px 6px 20px rgba(0,0,0,0.6)}100%{transform:scale(1);opacity:1;text-shadow:4px 4px 15px rgba(0,0,0,0.4)}}.modal{position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;z-index:1002;backdrop-filter:blur(5px)}.modal-content{background:var(--modal-bg);color:var(--modal-text-color);padding:30px;border-radius:20px;max-width:350px;width:90%;max-height:80vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.2);transform:scale(0.9);opacity:0;transition:all .3s ease;position:relative}.modal.visible .modal-content{transform:scale(1);opacity:1}.modal h3{margin-bottom:20px;color:var(--modal-header-color)}.form-group{margin-bottom:20px}.form-group label{display:block;margin-bottom:8px;font-weight:500}.form-group input,.form-group select,.form-group textarea{width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;font-size:16px;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}.mantra-controls{position:fixed;bottom:calc(60px + env(safe-area-inset-bottom));left:50%;transform:translateX(-50%);display:none;z-index:1001;transition:bottom .3s ease}.info-content{text-align:left;line-height:1.6}.info-content h4{margin:15px 0 10px 0;color:var(--modal-header-color)}.info-content ul{margin-left:20px;list-style-position:inside}.info-content li{margin-bottom:5px}#confirmMessage{font-size:18px;margin-bottom:25px;line-height:1.5;text-align:center}.confirm-buttons{display:flex;gap:15px}.confirm-buttons .btn{flex:1}.bottom-popup{position:absolute;bottom:calc(20px + env(safe-area-inset-bottom));left:20px;right:20px;width:auto;transform:none;background:var(--bottom-popup-bg);backdrop-filter:blur(10px);padding:20px 30px;border-radius:15px;text-align:center;z-index:20;border:1px solid rgba(255,255,255,0.2);box-shadow:0 10px 30px rgba(0,0,0,0.4)}.bottom-popup p{font-size:20px;color:white;margin-bottom:20px}.modal-close-btn{position:absolute;top:15px;right:15px;background:#e0e0e0;border:none;border-radius:50%;width:30px;height:30px;font-size:20px;color:#888;cursor:pointer;line-height:30px;text-align:center;transition:all .3s ease}.modal-close-btn:hover{background:#d0d0d0;color:#333;transform:rotate(90deg)}.time-stepper{display:flex;align-items:center;justify-content:center;gap:15px}.time-stepper button{width:40px;height:40px;border-radius:50%;border:1px solid #ccc;background:#f0f0f0;font-size:24px;font-weight:bold;color:var(--modal-header-color);cursor:pointer;transition:all .2s ease}.time-stepper button:hover{background:#e0e0e0;transform:scale(1.1)}.time-stepper span{font-size:22px;font-weight:500;min-width:40px;text-align:center}.color-picker{width:100%;height:40px;padding:0 5px;border-radius:8px;border:1px solid #ddd;cursor:pointer}@media (max-width:480px){.timer-display{font-size:24px;top:20px}.countdown-number{font-size:80px}.control-btn{padding:10px 18px;font-size:14px;min-width:80px}.meditation-controls{bottom:calc(20px + env(safe-area-inset-bottom))}}

        .toast-notification { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: rgba(40, 40, 40, 0.9); color: white; padding: 15px 25px; border-radius: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); z-index: 9999; opacity: 0; transition: opacity 0.5s, top 0.5s; backdrop-filter: blur(5px); border: 1px solid rgba(255,255,255,0.2); font-weight: 500; }
        .toast-notification.show { top: 40px; opacity: 1; }
        
        /* Admin Panel Styles */
        #masterAdminModal .modal-content { max-width: 90%; width: 600px; }
        #adminUsersTable { width: 100%; border-collapse: collapse; margin-top: 20px; }
        #adminUsersTable th, #adminUsersTable td { padding: 10px; border: 1px solid #ddd; text-align: left; }
        #adminUsersTable th { background-color: #f2f2f2; }
        .admin-tabs { display: flex; border-bottom: 1px solid #ccc; margin-bottom: 20px; }
        .admin-tab-btn { background: none; border: none; padding: 10px 15px; cursor: pointer; font-size: 16px; color: var(--modal-text-color); border-bottom: 3px solid transparent; }
        .admin-tab-btn.active { border-bottom-color: var(--modal-header-color); color: var(--modal-header-color); font-weight: bold; }
        .admin-tab-content { display: none; }
        .admin-tab-content.active { display: block; }

    </style>
</head>
<body data-theme="default-dark">
    <div class="container">
        <h1 class="app-title">üïâÔ∏è ‡§∂‡§ø‡§¶‡•ç‡§ß‡§Ø‡•ã‡§ó ‡§ß‡•ç‡§Ø‡§æ‡§®</h1>
        <p class="meditation-counter" id="meditationCounter"></p>
        <div class="guru-photo-container">
            <div class="guru-photo" id="guruPhoto"></div>
        </div>
        <div class="main-buttons">
            <button class="btn btn-start" onclick="startMeditation()">üßò‚Äç‚ôÇÔ∏è ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç</button>
            <button class="btn btn-info" onclick="showInfo()">‚ÑπÔ∏è ‡§ï‡•à‡§∏‡•á ‡§ï‡§∞‡•á‡§Ç</button>
        </div>
        <button class="btn btn-settings" onclick="showSettings()">‚öôÔ∏è ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏</button>
        <button id="logout-btn" class="btn" style="background: linear-gradient(45deg, #e17055, #d63031); margin-top: 10px;">üëã ‡§≤‡•â‡§ó‡§Ü‡§â‡§ü</button>
        <button id="adminButton" class="btn" onclick="openMasterAdminPanel()" style="background: linear-gradient(45deg, #2c3e50, #3498db); margin-top: 10px;">üëë ‡§è‡§°‡§Æ‡§ø‡§® ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°</button>
    </div>

    <!-- Other screens and modals -->
    <div class="countdown-screen" id="countdownScreen"><div class="countdown-number" id="countdownNumber">5</div><div style="color:white;margin-top:30px;font-size:18px" data-lang-key="countdownText">‡§ß‡•ç‡§Ø‡§æ‡§® ‡§∂‡•Å‡§∞‡•Ç ‡§π‡•ã‡§®‡•á ‡§Æ‡•á‡§Ç...</div></div><div class="meditation-screen" id="meditationScreen"><div class="meditation-photo" id="meditationPhoto"></div><div class="timer-display" id="timerDisplay">15:00</div><div class="meditation-controls"><button class="control-btn" id="pausePlayBtn" onclick="togglePausePlay()" data-lang-key="pause">‡§∞‡•ã‡§ï‡•á‡§Ç</button><button class="control-btn" onclick="restartMeditation()" data-lang-key="restart">‡§´‡§ø‡§∞ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç</button><button class="control-btn" onclick="goBack()" data-lang-key="back">‡§µ‡§æ‡§™‡§∏</button><button id="skipButton" class="control-btn" onclick="skipMeditationTimer()" style="display:none;background:#c0392b" data-lang-key="skipTimer">‡§ü‡§æ‡§á‡§Æ‡§∞ ‡§∏‡•ç‡§ï‡§ø‡§™</button></div><div class="bottom-popup" id="endScreenMessage" style="display:none"><p data-lang-key="completionMessage">üôè ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§π‡•Å‡§Ü üôè</p><button class="btn btn-start" id="okButton">‡§†‡•Ä‡§ï ‡§π‡•à</button></div><div id="finalControls" class="meditation-controls" style="opacity:0;pointer-events:none"><button class="btn btn-start" onclick="goBack(false)" data-lang-key="finalBackButton">‡§µ‡§æ‡§™‡§∏ ‡§ú‡§æ‡§è‡§Ç</button></div></div><div class="mantra-controls" id="mantraControls"><button class="control-btn" onclick="skipMantra()" data-lang-key="skipMantra">‚è≠Ô∏è ‡§Æ‡§Ç‡§§‡•ç‡§∞ ‡§∏‡•ç‡§ï‡§ø‡§™</button></div><div class="modal" id="settingsModal"><div class="modal-content"><button class="modal-close-btn" onclick="closeModal('settingsModal')">√ó</button><h3 data-lang-key="settingsTitle">‚öôÔ∏è ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏</h3><div class="form-group"><label data-lang-key="languageLabel">‡§≠‡§æ‡§∑‡§æ</label><select id="languageSelect" onchange="changeLanguage(this.value)"><option value="hindi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option><option value="english">English</option></select></div><div class="form-group"><label data-lang-key="themeLabel">‡§•‡•Ä‡§Æ</label><select id="themeSelect" onchange="changeTheme(this.value)"></select></div><div class="form-group"><label data-lang-key="timeLabel">‡§ß‡•ç‡§Ø‡§æ‡§® ‡§ï‡§æ ‡§∏‡§Æ‡§Ø (‡§Æ‡§ø‡§®‡§ü)</label><div class="time-stepper"><button id="timeDecrement">-</button><span id="timeValue">15</span><button id="timeIncrement">+</button></div></div><div class="form-group"><label data-lang-key="bgColorLabel">‡§ß‡•ç‡§Ø‡§æ‡§® ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§ï‡§æ ‡§∞‡§Ç‡§ó</label><input type="color" id="meditationBgColor" class="color-picker"></div><div style="text-align:center;color:#777;margin-top:20px"><p data-lang-key="settingsInfo">‡§Æ‡§Ç‡§§‡•ç‡§∞, ‡§Ö‡§≤‡§æ‡§∞‡•ç‡§Æ ‡§î‡§∞ ‡§ó‡•Å‡§∞‡•Å‡§¶‡•á‡§µ ‡§ï‡•Ä ‡§´‡•ã‡§ü‡•ã ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§π‡•Ä ‡§∏‡•á‡§ü ‡§π‡•à‡§Ç‡•§</p></div></div></div>
    <!-- ‚úÖ FIX: ‡§™‡•Å‡§∞‡§æ‡§®‡§æ adminModal ‡§π‡§ü‡§æ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à ‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø ‡§â‡§∏‡§ï‡§æ ‡§ï‡§Ç‡§ü‡•á‡§Ç‡§ü ‡§®‡§è Master Admin Panel ‡§Æ‡•á‡§Ç ‡§°‡§æ‡§≤ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§ -->
    <div class="modal" id="infoModal"><div class="modal-content"><button class="modal-close-btn" onclick="closeModal('infoModal')">√ó</button><h3 id="infoTitle" data-lang-key="howToTitle">üßò‚Äç‚ôÇÔ∏è ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§ï‡•à‡§∏‡•á ‡§ï‡§∞‡•á‡§Ç</h3><div class="info-content" id="infoContentDiv"></div><button class="btn btn-info" onclick="closeModal('infoModal')" style="width:100%;margin-top:20px" data-lang-key="gotItButton">‚úÖ ‡§∏‡§Æ‡§ù ‡§ó‡§Ø‡§æ</button></div></div><div class="modal" id="confirmModal"><div class="modal-content"><p id="confirmMessage">‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§π‡•à‡§Ç?</p><div class="confirm-buttons"><button id="confirmYes" class="btn btn-start">‡§π‡§æ‡§Å</button><button id="confirmNo" class="btn btn-info">‡§®‡§π‡•Ä‡§Ç</button></div></div></div>
    
    <!-- ‚úÖ FIX: ‡§Ø‡§π ‡§®‡§Ø‡§æ All-in-One ‡§è‡§°‡§Æ‡§ø‡§® ‡§™‡•à‡§®‡§≤ ‡§π‡•à ‡§ú‡§ø‡§∏‡§Æ‡•á‡§Ç ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§ü‡•à‡§¨ ‡§ï‡§æ ‡§ï‡§Ç‡§ü‡•á‡§Ç‡§ü ‡§∏‡•Ä‡§ß‡•á HTML ‡§Æ‡•á‡§Ç ‡§π‡•à‡•§ -->
    <div class="modal" id="masterAdminModal">
        <div class="modal-content" style="max-width: 90%; width: 600px;">
            <button class="modal-close-btn" onclick="closeModal('masterAdminModal')">√ó</button>
            <h3>üëë ‡§è‡§°‡§Æ‡§ø‡§® ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°</h3>
            
            <div class="admin-tabs">
                <button class="admin-tab-btn active" onclick="showAdminTab('users', this)">‡§Ø‡•Ç‡§ú‡§º‡§∞‡•ç‡§∏ ‡§≤‡§ø‡§∏‡•ç‡§ü</button>
                <button class="admin-tab-btn" onclick="showAdminTab('content', this)">‡§ï‡§Ç‡§ü‡•á‡§Ç‡§ü ‡§è‡§°‡§ø‡§ü‡§∞</button>
            </div>

            <!-- Tab 1: Users List -->
            <div id="adminTabContentUsers" class="admin-tab-content active">
                <h4>‡§∏‡§≠‡•Ä ‡§Ø‡•Ç‡§ú‡§º‡§∞‡•ç‡§∏</h4>
                <div id="adminUsersContent" style="overflow-x:auto;">‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</div>
            </div>

            <!-- Tab 2: Content Editor -->
            <div id="adminTabContentContent" class="admin-tab-content">
                <h4 data-lang-key="adminPanelTitle">üë®‚Äçüíº ‡§ï‡§Ç‡§ü‡•á‡§Ç‡§ü ‡§è‡§°‡§ø‡§ü‡§∞</h4>
                <div class="form-group"><label data-lang-key="mainTitleLabel"><strong>‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï</strong></label><input type="text" id="adminMainTitle"></div>
                <div class="form-group"><label data-lang-key="meditationStepsLabel"><strong>‡§ß‡•ç‡§Ø‡§æ‡§® ‡§ï‡•Ä ‡§µ‡§ø‡§ß‡§ø (‡§π‡§∞ ‡§≤‡§æ‡§á‡§® ‡§®‡§à)</strong></label><textarea id="adminMeditationSteps" rows="5"></textarea></div>
                <div class="form-group"><label data-lang-key="benefitsLabel"><strong>‡§ß‡•ç‡§Ø‡§æ‡§® ‡§ï‡•á ‡§≤‡§æ‡§≠ (‡§π‡§∞ ‡§≤‡§æ‡§á‡§® ‡§®‡§Ø‡§æ)</strong></label><textarea id="adminBenefits" rows="4"></textarea></div>
                <div class="form-group"><label data-lang-key="appUsageLabel"><strong>‡§ê‡§™ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó (‡§π‡§∞ ‡§≤‡§æ‡§á‡§® ‡§®‡§à)</strong></label><textarea id="adminAppUsage" rows="4"></textarea></div>
                <div class="form-group"><label data-lang-key="extraInfoLabel"><strong>‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï)</strong></label><textarea id="adminExtraInfo" rows="3"></textarea></div>
                <div style="display:flex;gap:10px;margin-top:30px">
                    <button class="btn btn-start" onclick="saveAdminSettings()" style="flex:1" data-lang-key="saveButton">üíæ ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç</button>
                    <button class="btn btn-info" onclick="previewInfo()" style="flex:1" data-lang-key="previewButton">üëÅÔ∏è ‡§™‡•ç‡§∞‡•Ä‡§µ‡•ç‡§Ø‡•Ç</button>
                </div>
            </div>
        </div>
    </div>

    <div id="toast-notification" class="toast-notification"></div>

    <script>
        // --- All the old Javascript code (minified for performance) ---
        let meditationTimer,countdownTimer,mantraAudio,alarmAudio;let isMantraPlaying=!1,isPaused=!1,totalSeconds;const themes={'default-dark':{name:'Default Dark',isDark:!0},'night-sky':{name:'Night Sky',isDark:!0},'deep-forest':{name:'Deep Forest',isDark:!0},sunrise:{name:'Sunrise',isDark:!1},mint:{name:'Mint',isDark:!1},'peaceful-lilac':{name:'Peaceful Lilac',isDark:!1}};const appState={meditationTime:15,language:'hindi',theme:'default-dark',meditationBgColor:'#000000',customInfo:{hindi:{mainTitle:"‡§∂‡§ø‡§¶‡•ç‡§ß‡§Ø‡•ã‡§ó ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§ï‡•Ä ‡§µ‡§ø‡§ß‡§ø:",meditationSteps:["‡§§‡•à‡§Ø‡§æ‡§∞‡•Ä: ‡§∂‡§æ‡§Ç‡§§ ‡§∏‡•ç‡§•‡§æ‡§® ‡§™‡§∞ ‡§¨‡•à‡§†‡•á‡§Ç, ‡§Ü‡§Ç‡§ñ‡•á‡§Ç ‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç","‡§¶‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§Æ‡§Ç‡§§‡•ç‡§∞: ‡§™‡§π‡§≤‡•á ‡§ó‡•Å‡§∞‡•Å‡§¶‡•á‡§µ ‡§ï‡§æ ‡§¶‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§Æ‡§Ç‡§§‡•ç‡§∞ ‡§∏‡•Å‡§®‡•á‡§Ç","‡§ó‡•Å‡§∞‡•Å ‡§¶‡§∞‡•ç‡§∂‡§®: ‡§ó‡•Å‡§∞‡•Å‡§¶‡•á‡§µ ‡§ï‡•Ä ‡§´‡•ã‡§ü‡•ã ‡§™‡§∞ ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç","‡§∂‡•ç‡§µ‡§æ‡§∏: ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§≤‡•á‡§Ç, ‡§Æ‡§® ‡§ï‡•ã ‡§∂‡§æ‡§Ç‡§§ ‡§∞‡§ñ‡•á‡§Ç","‡§∏‡§Æ‡§∞‡•ç‡§™‡§£: ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∏‡§Æ‡§∞‡•ç‡§™‡§£ ‡§≠‡§æ‡§µ ‡§∞‡§ñ‡•á‡§Ç"],benefits:["‡§Æ‡§æ‡§®‡§∏‡§ø‡§ï ‡§∂‡§æ‡§Ç‡§§‡§ø","‡§Ü‡§ß‡•ç‡§Ø‡§æ‡§§‡•ç‡§Æ‡§ø‡§ï ‡§â‡§®‡•ç‡§®‡§§‡§ø","‡§è‡§ï‡§æ‡§ó‡•ç‡§∞‡§§‡§æ ‡§Æ‡•á‡§Ç ‡§µ‡•É‡§¶‡•ç‡§ß‡§ø","‡§§‡§®‡§æ‡§µ ‡§Æ‡•Å‡§ï‡•ç‡§§‡§ø"],appUsage:["‡§ó‡•Å‡§∞‡•Å‡§¶‡•á‡§µ ‡§ï‡•Ä ‡§´‡•ã‡§ü‡•ã ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç","‡§∏‡§Æ‡§Ø ‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç","‡§Æ‡§Ç‡§§‡•ç‡§∞ ‡§î‡§∞ ‡§Ö‡§≤‡§æ‡§∞‡•ç‡§Æ ‡§ö‡•Å‡§®‡•á‡§Ç","‡§®‡§ø‡§Ø‡§Æ‡§ø‡§§ ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç"],extraInfo:""},english:{mainTitle:"Method of Shidhdhayog Meditation:",meditationSteps:["Preparation: Sit in a quiet place, close your eyes","Initiation Mantra: First, listen to Gurudev's initiation mantra","Guru Darshan: Focus on Gurudev's photo","Breathing: Breathe normally, keep your mind calm","Surrender: Maintain a state of complete surrender"],benefits:["Mental peace","Spiritual progress","Increased concentration","Stress relief"],appUsage:["Upload Gurudev's photo","Set the time","Choose mantra and alarm","Practice regularly"],extraInfo:""}}};const translations={hindi:{appTitle:"üïâÔ∏è ‡§∂‡§ø‡§¶‡•ç‡§ß‡§Ø‡•ã‡§ó ‡§ß‡•ç‡§Ø‡§æ‡§®",startButton:"üßò‚Äç‚ôÇÔ∏è ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç",infoButton:"‚ÑπÔ∏è ‡§ï‡•à‡§∏‡•á ‡§ï‡§∞‡•á‡§Ç",settingsButton:"‚öôÔ∏è ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏",adminButton:"üë®‚Äçüíº ‡§è‡§°‡§Æ‡§ø‡§® ‡§™‡•à‡§®‡§≤",countdownText:"‡§ß‡•ç‡§Ø‡§æ‡§® ‡§∂‡•Å‡§∞‡•Ç ‡§π‡•ã‡§®‡•á ‡§Æ‡•á‡§Ç...",pause:"‡§∞‡•ã‡§ï‡•á‡§Ç",play:"‡§ö‡§≤‡§æ‡§è‡§Ç",restart:"‡§´‡§ø‡§∞ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç",back:"‡§µ‡§æ‡§™‡§∏",skipTimer:"‡§ü‡§æ‡§á‡§Æ‡§∞ ‡§∏‡•ç‡§ï‡§ø‡§™",completionMessage:"üôè ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§π‡•Å‡§Ü üôè",finalBackButton:"‡§µ‡§æ‡§™‡§∏ ‡§ú‡§æ‡§è‡§Ç",okButton:"‡§†‡•Ä‡§ï ‡§π‡•à",skipMantra:"‚è≠Ô∏è ‡§Æ‡§Ç‡§§‡•ç‡§∞ ‡§∏‡•ç‡§ï‡§ø‡§™",settingsTitle:"‚öôÔ∏è ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏",languageLabel:"‡§≠‡§æ‡§∑‡§æ",timeLabel:"‡§ß‡•ç‡§Ø‡§æ‡§® ‡§ï‡§æ ‡§∏‡§Æ‡§Ø (‡§Æ‡§ø‡§®‡§ü)",bgColorLabel:"‡§ß‡•ç‡§Ø‡§æ‡§® ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§ï‡§æ ‡§∞‡§Ç‡§ó",themeLabel:"‡§•‡•Ä‡§Æ",settingsInfo:"‡§Æ‡§Ç‡§§‡•ç‡§∞, ‡§Ö‡§≤‡§æ‡§∞‡•ç‡§Æ ‡§î‡§∞ ‡§ó‡•Å‡§∞‡•Å‡§¶‡•á‡§µ ‡§ï‡•Ä ‡§´‡•ã‡§ü‡•ã ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§π‡•Ä ‡§∏‡•á‡§ü ‡§π‡•à‡§Ç‡•§",howToTitle:"üßò‚Äç‚ôÇÔ∏è ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§ï‡•à‡§∏‡•á ‡§ï‡§∞‡•á‡§Ç",gotItButton:"‚úÖ ‡§∏‡§Æ‡§ù ‡§ó‡§Ø‡§æ",adminPanelTitle:"üë®‚Äçüíº ‡§è‡§°‡§Æ‡§ø‡§® ‡§™‡•à‡§®‡§≤",mainTitleLabel:"‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï",meditationStepsLabel:"‡§ß‡•ç‡§Ø‡§æ‡§® ‡§ï‡•Ä ‡§µ‡§ø‡§ß‡§ø",benefitsLabel:"‡§ß‡•ç‡§Ø‡§æ‡§® ‡§ï‡•á ‡§≤‡§æ‡§≠",appUsageLabel:"‡§ê‡§™ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó",extraInfoLabel:"‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä",saveButton:"üíæ ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç",previewButton:"üëÅÔ∏è ‡§™‡•ç‡§∞‡•Ä‡§µ‡•ç‡§Ø‡•Ç",restartConfirm:"‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§´‡§ø‡§∞ ‡§∏‡•á ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?",stopConfirm:"‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§µ‡§æ‡§ï‡§à ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§∞‡•ã‡§ï‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?",confirmYes:"‡§π‡§æ‡§Å",confirmNo:"‡§®‡§π‡•Ä‡§Ç"},english:{appTitle:"üïâÔ∏è Shidhdhayog Meditation",startButton:"üßò‚Äç‚ôÇÔ∏è Start",infoButton:"‚ÑπÔ∏è How To",settingsButton:"‚öôÔ∏è Settings",adminButton:"üë®‚Äçüíº Admin Panel",countdownText:"Meditation starting in...",pause:"Pause",play:"Play",restart:"Restart",back:"Back",skipTimer:"Skip Timer",completionMessage:"üôè Meditation Complete üôè",finalBackButton:"Go Back",okButton:"OK",skipMantra:"‚è≠Ô∏è Skip Mantra",settingsTitle:"‚öôÔ∏è Settings",languageLabel:"Language",timeLabel:"Meditation Time (minutes)",bgColorLabel:"Meditation Screen Color",themeLabel:"Theme",settingsInfo:"Mantra, alarm, and Gurudev's photo are pre-set.",howToTitle:"üßò‚Äç‚ôÇÔ∏è How to Meditate",gotItButton:"‚úÖ Got It",adminPanelTitle:"üë®‚Äçüíº Admin Panel",mainTitleLabel:"Main Title",meditationStepsLabel:"Meditation Steps",benefitsLabel:"Benefits",appUsageLabel:"App Usage",extraInfoLabel:"Extra Info",saveButton:"üíæ Save",previewButton:"üëÅÔ∏è Preview",restartConfirm:"Do you want to restart the meditation?",stopConfirm:"Do you really want to stop the meditation?",confirmYes:"Yes",confirmNo:"No"}};function saveAppState(){try{localStorage.setItem('shidhdhayogAppState',JSON.stringify(appState))}catch(e){console.error("Could not save state:",e)}}function loadAppState(){const savedState=localStorage.getItem('shidhdhayogAppState');if(savedState)try{const loaded=JSON.parse(savedState);Object.assign(appState,loaded)}catch(error){console.error("Could not parse saved state:",error)}document.getElementById('languageSelect').value=appState.language;document.getElementById('timeValue').textContent=appState.meditationTime;document.getElementById('meditationBgColor').value=appState.meditationBgColor;populateThemeSelector();applyTheme(appState.theme);updateUIText()}function updateUIText(){const lang=appState.language;document.querySelectorAll('[data-lang-key]').forEach(el=>{const key=el.getAttribute('data-lang-key');if(translations[lang]&&translations[lang][key])el.innerHTML=translations[lang][key]});updateInfoModal()}function changeLanguage(lang){appState.language=lang;saveAppState();updateUIText()}function applyTheme(themeKey){document.body.setAttribute('data-theme',themeKey)}function changeTheme(themeKey){appState.theme=themeKey;applyTheme(themeKey);saveAppState()}function populateThemeSelector(){const selector=document.getElementById('themeSelect');selector.innerHTML='';for(const key in themes){const option=document.createElement('option');option.value=key;option.textContent=themes[key].name;selector.appendChild(option)}selector.value=appState.theme}function startMeditation(){document.getElementById('meditationScreen').style.backgroundColor=appState.meditationBgColor;document.getElementById('meditationScreen').style.display='flex';requestWakeLock();if(document.documentElement.requestFullscreen)document.documentElement.requestFullscreen().catch(err=>console.log(err));startMantra()}function startMantra(){updateVisibility('mantra');if(mantraAudio){isMantraPlaying=!0;mantraAudio.currentTime=0;mantraAudio.onended=()=>{if(isMantraPlaying){isMantraPlaying=!1;startCountdown()}};mantraAudio.play().catch(error=>{console.error("Audio play failed.",error)})}else console.log("Mantra audio not loaded.")}function skipMantra(){if(isMantraPlaying&&mantraAudio){mantraAudio.pause();mantraAudio.currentTime=0}isMantraPlaying=!1;startCountdown()}function startCountdown(){updateVisibility('countdown');let count=5;document.getElementById('countdownNumber').textContent=count;countdownTimer=setInterval(()=>{count--;if(count>0){const el=document.getElementById('countdownNumber');el.textContent=count;el.style.animation='none';setTimeout(()=>{el.style.animation='pulse 1s ease-in-out'},10)}else{clearInterval(countdownTimer);startMeditationTimer()}},1000)}
        let currentUser = null;
        function startMeditationTimer(){updateVisibility('meditating');totalSeconds=appState.meditationTime*60;updateTimerDisplay(totalSeconds);isPaused=!1;document.getElementById('pausePlayBtn').innerHTML=translations[appState.language].pause;meditationTimer=setInterval(()=>{if(!isPaused){totalSeconds--;updateTimerDisplay(totalSeconds);if(totalSeconds<=0){clearInterval(meditationTimer);endMeditation()}}},1000)}
        async function endMeditation(){updateVisibility('finished');if(alarmAudio){alarmAudio.loop=!0;alarmAudio.play().catch(e=>console.error("Alarm play failed:",e))}if(currentUser&&currentUser.id){const{error}=await supabase.rpc('increment',{user_id_input:currentUser.id});if(error)console.error('Error updating count:',error);else{console.log('Count updated!');const counterEl=document.getElementById('meditationCounter');const currentCount=parseInt(counterEl.textContent.match(/\d+/)[0])+1;counterEl.textContent=`‡§Ü‡§™‡§®‡•á ‡§Ö‡§¨ ‡§§‡§ï ${currentCount} ‡§¨‡§æ‡§∞ ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§π‡•à‡•§`}}}
        function togglePausePlay(){isPaused=!isPaused;document.getElementById('pausePlayBtn').innerHTML=isPaused?translations[appState.language].play:translations[appState.language].pause}function restartMeditation(){showConfirmation('restartConfirm',()=>{clearInterval(meditationTimer);startMeditationTimer()})}function skipMeditationTimer(){if(totalSeconds>0){totalSeconds=1;document.getElementById('skipButton').style.display='none'}}function goBack(confirmFirst=!0){const doGoBack=()=>{clearInterval(meditationTimer);clearInterval(countdownTimer);if(mantraAudio){mantraAudio.pause();mantraAudio.currentTime=0}if(alarmAudio){alarmAudio.pause();alarmAudio.currentTime=0;alarmAudio.loop=!1}isMantraPlaying=!1;meditationTimer=null;document.getElementById('meditationScreen').style.display='none';releaseWakeLock();if(document.exitFullscreen)document.exitFullscreen()};if(confirmFirst&&meditationTimer)showConfirmation('stopConfirm',doGoBack);else doGoBack()}function updateVisibility(state){const medScreen=document.getElementById('meditationScreen');const countdownScreen=document.getElementById('countdownScreen');const mantraControls=document.getElementById('mantraControls');const meditationControls=document.querySelector('.meditation-controls');const timerDisplay=document.getElementById('timerDisplay');const endScreenMessage=document.getElementById('endScreenMessage');const finalControls=document.getElementById('finalControls');[countdownScreen,mantraControls,meditationControls,timerDisplay,endScreenMessage,finalControls].forEach(el=>el.style.display='none');medScreen.classList.remove('controls-visible');switch(state){case'mantra':mantraControls.style.display='flex';break;case'countdown':countdownScreen.style.display='flex';break;case'meditating':meditationControls.style.display='flex';timerDisplay.style.display='block';break;case'finished':endScreenMessage.style.display='block';break;case'final':finalControls.style.display='flex';finalControls.style.opacity='1';finalControls.style.pointerEvents='auto';break}}function showModal(id){const el=document.getElementById(id);el.style.display='flex';setTimeout(()=>el.classList.add('visible'),10)}function closeModal(id){const el=document.getElementById(id);el.classList.remove('visible');setTimeout(()=>el.style.display='none',300)}function showSettings(){showModal('settingsModal')}function showInfo(){updateInfoModal();showModal('infoModal')}function updateTimerDisplay(seconds){const minutes=Math.floor(seconds/60);const remainingSeconds=seconds%60;document.getElementById('timerDisplay').textContent=`${String(minutes).padStart(2,'0')}:${String(remainingSeconds).padStart(2,'0')}`}function updateInfoModal(){const lang=appState.language;const info=appState.customInfo[lang];if(!info)return;const infoContent=document.getElementById('infoContentDiv');let stepsHtml=info.meditationSteps.map(s=>`<li>${s}</li>`).join('');let benefitsHtml=info.benefits.map(b=>`<li>${b}</li>`).join('');let usageHtml=info.appUsage.map(u=>`<li>${u}</li>`).join('');let extraSection=info.extraInfo?`<h4>üìù ${lang==='hindi'?'‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä:':'Extra Info:'}</h4><p>${info.extraInfo}</p>`:'';infoContent.innerHTML=`<h4>${info.mainTitle}</h4><ul>${stepsHtml}</ul><h4>üéØ ${lang==='hindi'?'‡§ß‡•ç‡§Ø‡§æ‡§® ‡§ï‡•á ‡§≤‡§æ‡§≠:':'Benefits:'}</h4><ul>${benefitsHtml}</ul><h4>üì± ${lang==='hindi'?'‡§ê‡§™ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó:':'App Usage:'}</h4><ul>${usageHtml}</ul>${extraSection}`}let wakeLock=null;async function requestWakeLock(){if('wakeLock'in navigator)try{wakeLock=await navigator.wakeLock.request('screen')}catch(err){console.error(`${err.name}, ${err.message}`)}}function releaseWakeLock(){if(wakeLock)wakeLock.release().then(()=>{wakeLock=null})}function showConfirmation(messageKey,onConfirm){const message=translations[appState.language][messageKey];const confirmModal=document.getElementById('confirmModal');document.getElementById('confirmMessage').textContent=message;document.getElementById('confirmYes').innerHTML=translations[appState.language].confirmYes;document.getElementById('confirmNo').innerHTML=translations[appState.language].confirmNo;showModal('confirmModal');const yesBtn=document.getElementById('confirmYes');const noBtn=document.getElementById('confirmNo');const handleYes=()=>{onConfirm();cleanup()};const handleNo=()=>{cleanup()};const cleanup=()=>{closeModal('confirmModal');yesBtn.removeEventListener('click',handleYes);noBtn.removeEventListener('click',handleNo)};yesBtn.addEventListener('click',handleYes);noBtn.addEventListener('click',handleNo)}window.addEventListener('load',function(){function initializeAppAssets(){const photoUrl='gurudev.jpg';document.getElementById('guruPhoto').innerHTML=`<img src="${photoUrl}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;" alt="‡§ó‡•Å‡§∞‡•Å‡§¶‡•á‡§µ">`;document.getElementById('meditationPhoto').innerHTML=`<img src="${photoUrl}" alt="‡§ó‡•Å‡§∞‡•Å‡§¶‡•á‡§µ">`;try{mantraAudio=new Audio('mantra.mp3');alarmAudio=new Audio('alarm.mp3');mantraAudio.preload='auto';alarmAudio.preload='auto'}catch(e){console.error("Error loading audio:",e)}}loadAppState();initializeAppAssets();let tapCount=0,tapTimer=null;document.getElementById('meditationScreen').addEventListener('click',function(event){if(event.target.closest('.control-btn, .bottom-popup, .btn'))return;const medControls=document.querySelector('.meditation-controls');if(medControls.style.display==='flex'){this.classList.toggle('controls-visible');clearTimeout(tapTimer);tapCount++;if(tapCount>=7){document.getElementById('skipButton').style.display='flex';tapCount=0}tapTimer=setTimeout(()=>{tapCount=0},2000)}});document.getElementById('okButton').addEventListener('click',function(){if(alarmAudio){alarmAudio.pause();alarmAudio.currentTime=0;alarmAudio.loop=!1}updateVisibility('final')});document.getElementById('timeDecrement').addEventListener('click',()=>{let currentTime=parseInt(appState.meditationTime);if(currentTime>1){appState.meditationTime=currentTime-1;document.getElementById('timeValue').textContent=appState.meditationTime;saveAppState()}});document.getElementById('timeIncrement').addEventListener('click',()=>{let currentTime=parseInt(appState.meditationTime);if(currentTime<120){appState.meditationTime=currentTime+1;document.getElementById('timeValue').textContent=appState.meditationTime;saveAppState()}});document.getElementById('meditationBgColor').addEventListener('input',e=>{appState.meditationBgColor=e.target.value;saveAppState()})});function loadAdminData(){const lang=appState.language;if(!appState.customInfo[lang])appState.customInfo[lang]=JSON.parse(JSON.stringify(appState.customInfo.english));const info=appState.customInfo[lang];document.getElementById('adminMainTitle').value=info.mainTitle;document.getElementById('adminMeditationSteps').value=info.meditationSteps.join('\n');document.getElementById('adminBenefits').value=info.benefits.join('\n');document.getElementById('adminAppUsage').value=info.appUsage.join('\n');document.getElementById('adminExtraInfo').value=info.extraInfo}function saveAdminSettings(showAlert = true){const lang=appState.language;if(!appState.customInfo[lang])appState.customInfo[lang]={};appState.customInfo[lang].mainTitle=document.getElementById('adminMainTitle').value.trim();appState.customInfo[lang].meditationSteps=document.getElementById('adminMeditationSteps').value.split('\n').filter(s=>s.trim());appState.customInfo[lang].benefits=document.getElementById('adminBenefits').value.split('\n').filter(b=>b.trim());appState.customInfo[lang].appUsage=document.getElementById('adminAppUsage').value.split('\n').filter(u=>u.trim());appState.customInfo[lang].extraInfo=document.getElementById('adminExtraInfo').value.trim();saveAppState();if(showAlert){showToast(translations[lang].saveButton+(lang==='hindi'?" ‡§π‡•ã ‡§ó‡§Ø‡§æ!":" Saved!"))}updateInfoModal()}function previewInfo(){saveAdminSettings(false);showInfo()}
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const SUPABASE_URL = "https://dskxbznrmnytmvcrllja.supabase.co";
        const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRza3hiem5ybW55dG12Y3JsbGphIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3OTc2NDIsImV4cCI6MjA3MzM3MzY0Mn0.jTNx3kdO5K8tDtfwNPm1MrFD3TDiyybPOzv5oC4diGg";
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        function showToast(message) {
            const toast = document.getElementById('toast-notification');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => { toast.classList.remove('show'); }, 2500);
        }

        (async () => {
            const { data: { session }, error: sessionError } = await supabase.auth.getSession();
            if (sessionError || !session) {
                window.location.href = "login.html";
                return;
            }

            currentUser = session.user;
            
            const { data: profile, error: profileError } = await supabase
                .from('profiles')
                .select('full_name, meditation_count, is_admin')
                .eq('id', currentUser.id)
                .single();

            if (profileError) {
                console.error('Error fetching profile:', profileError);
                document.querySelector('.app-title').textContent = '‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à!';
            } else if (profile) {
                document.querySelector('.app-title').textContent = `‡§®‡§Æ‡§∏‡•ç‡§§‡•á, ${profile.full_name}!`;
                document.getElementById('meditationCounter').textContent = `‡§Ü‡§™‡§®‡•á ‡§Ö‡§¨ ‡§§‡§ï ${profile.meditation_count || 0} ‡§¨‡§æ‡§∞ ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§π‡•à‡•§`;
                // ‚úÖ FIX: Admin Button ‡§Ö‡§¨ ‡§°‡•á‡§ü‡§æ‡§¨‡•á‡§∏ ‡§ï‡•á 'is_admin' ‡§´‡•ç‡§≤‡•à‡§ó ‡§∏‡•á ‡§ï‡§Ç‡§ü‡•ç‡§∞‡•ã‡§≤ ‡§π‡•ã‡§ó‡§æ‡•§
                if (profile.is_admin) {
                    document.getElementById('adminButton').style.display = 'block';
                }
            }
        })();
        
        // ‚úÖ FIX: ‡§Ø‡§π All-in-One ‡§è‡§°‡§Æ‡§ø‡§® ‡§™‡•à‡§®‡§≤ ‡§ï‡§æ ‡§®‡§Ø‡§æ ‡§î‡§∞ ‡§∏‡§æ‡§´‡§º-‡§∏‡•Å‡§•‡§∞‡§æ ‡§≤‡•â‡§ú‡§ø‡§ï ‡§π‡•à‡•§
        function openMasterAdminPanel() {
            showModal('masterAdminModal');
            // ‡§™‡•à‡§®‡§≤ ‡§ñ‡•ã‡§≤‡§§‡•á ‡§π‡•Ä ‡§Ø‡•Ç‡§ú‡§º‡§∞‡•ç‡§∏ ‡§ü‡•à‡§¨ ‡§ï‡§æ ‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡•ã
            loadAllUsers();
            // ‡§î‡§∞ ‡§ï‡§Ç‡§ü‡•á‡§Ç‡§ü ‡§è‡§°‡§ø‡§ü‡§∞ ‡§ï‡§æ ‡§°‡•á‡§ü‡§æ ‡§≠‡•Ä ‡§≤‡•ã‡§° ‡§ï‡§∞ ‡§¶‡•ã
            loadAdminData();
        }

        function showAdminTab(tabName, clickedButton) {
            document.querySelectorAll('.admin-tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.admin-tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(`adminTabContent${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`).classList.add('active');
            clickedButton.classList.add('active');
        }

        async function loadAllUsers() {
            const contentDiv = document.getElementById('adminUsersContent');
            contentDiv.innerHTML = '‡§Ø‡•Ç‡§ú‡§º‡§∞‡•ç‡§∏ ‡§ï‡§æ ‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...';

            // ‚úÖ FIX: ‡§Ö‡§¨ ‡§π‡§Æ ‡§∏‡•Ä‡§ß‡•á ‡§ü‡•á‡§¨‡§≤ ‡§ï‡•ã ‡§®‡§π‡•Ä‡§Ç, ‡§¨‡§≤‡•ç‡§ï‡§ø ‡§è‡§ï ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ 'function' ‡§ï‡•ã ‡§ï‡•â‡§≤ ‡§ï‡§∞‡•á‡§Ç‡§ó‡•á‡•§
            // ‡§á‡§∏‡§∏‡•á ‡§∏‡§ø‡§∞‡•ç‡§´ ‡§è‡§°‡§Æ‡§ø‡§® ‡§π‡•Ä ‡§°‡•á‡§ü‡§æ ‡§¶‡•á‡§ñ ‡§™‡§æ‡§è‡§ó‡§æ‡•§
            const { data: users, error } = await supabase.rpc('get_all_users_for_admin');

            if (error) {
                // ‚úÖ FIX: ‡§ü‡§æ‡§á‡§™‡•ã ‡§†‡•Ä‡§ï ‡§ï‡§ø‡§Ø‡§æ ‡§î‡§∞ ‡§ú‡§º‡•ç‡§Ø‡§æ‡§¶‡§æ ‡§Æ‡§¶‡§¶‡§ó‡§æ‡§∞ ‡§è‡§∞‡§∞ ‡§Æ‡•à‡§∏‡•á‡§ú ‡§ú‡•ã‡§°‡§º‡§æ‡•§
                contentDiv.innerHTML = '‡§°‡•á‡§ü‡§æ ‡§≤‡§æ‡§®‡•á ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§à ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§π‡•Å‡§à‡•§ ‡§∏‡•Å‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç ‡§ï‡§ø ‡§Ü‡§™ ‡§è‡§°‡§Æ‡§ø‡§® ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§Ü‡§™‡§ï‡•Ä RLS ‡§™‡•â‡§≤‡§ø‡§∏‡•Ä ‡§∏‡§π‡•Ä ‡§π‡•à‡•§';
                console.error('Admin Fetch Error:', error.message);
                return;
            }

            if (users && users.length > 0) {
                let tableHTML = '<table id="adminUsersTable"><thead><tr><th>‡§®‡§æ‡§Æ</th><th>‡§ß‡•ç‡§Ø‡§æ‡§® ‡§ï‡§æ‡§â‡§Ç‡§ü</th></tr></thead><tbody>';
                users.forEach(user => {
                    tableHTML += `<tr><td>${user.full_name}</td><td>${user.meditation_count || 0}</td></tr>`;
                });
                tableHTML += '</tbody></table>';
                contentDiv.innerHTML = tableHTML;
            } else {
                contentDiv.innerHTML = '‡§Ö‡§≠‡•Ä ‡§ï‡•ã‡§à ‡§Ø‡•Ç‡§ú‡§º‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§';
            }
        }

        document.getElementById("logout-btn").addEventListener("click", async () => {
            const { error } = await supabase.auth.signOut();
            if (error) {
                showToast("‡§≤‡•â‡§ó‡§Ü‡§â‡§ü ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§π‡•Å‡§à: " + error.message);
            } else {
                showToast("‡§Ü‡§™ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§≤‡•â‡§ó‡§Ü‡§â‡§ü ‡§π‡•ã ‡§ó‡§è ‡§π‡•à‡§Ç!");
                setTimeout(() => { window.location.href = "login.html"; }, 1500);
            }
        });
    </script>
</body>
</html>